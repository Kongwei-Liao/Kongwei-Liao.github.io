

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="liaogangwei的个人主页">
  <meta name="author" content="Kongwei_Liao">
  <meta name="keywords" content="black, foolish, positive">
  <title>Kongwei_Liao</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-15 19:45" pubdate>
        2021年2月15日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      172
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none"></h1>
            
            <div class="markdown-body">
              <h2 id="MyBatis持久层框架"><a href="#MyBatis持久层框架" class="headerlink" title="MyBatis持久层框架"></a>MyBatis持久层框架</h2><p>MyBatis框架，此框架的主要作用就是更加便捷的操作数据库，比如：MyBatis做查询时可以将ResultSet对象返回的数据记录自动封装进Entity实体类或List中、可以把SQL语句配置到XML文件中，也就是将SQL语句与*.java文件进行分离，有利于代码的后期维护，也使代码的分层更加明确。</p>
<p>MyBatis不是一个独立的技术，它内部的操作数据库的原理还是使用JDBC，其只是对JDBC进行了轻量级的封装，便于程序员更加方便的设计代码去操作数据库。</p>
<p>MyBatis是一个“持久化ORM框架”，持久化是指内存中的数据保存到硬盘上。ORM（Object Relation Mapping）对象关系映射，从两方面介绍：</p>
<ol>
<li>大的方面，一个类对应表中的一行；</li>
<li>小的方面，一个类中的属性对应一个表中的列。</li>
</ol>
<p>也就是说在使用MyBatis框架时，可以将Java类转化成数据表中的记录，或者将数据表中的记录转化成Java中的类，内部技术的原理其实就是JDBC+Java反射技术。</p>
<p>MyBatis 是一个支持普通 SQL查询、存储过程和高级映射的<code>优秀的持久层框架</code>。MyBatis 消除了几乎所有的 JDBC代码 和 手工设置参数 ，以及结果集的检索。</p>
<p>MyBatis 使用简单的 <code>XML</code> 或 <code>注解</code> 用于配置和原始映射，将<code>接口</code>和 <code>Java 的POJOs</code>（Plain Old Java Objects，普通的 Java对象）映射成数据库中的记录。MyBatis不能自动创建表，如果能够自动建表，必须自己事先准备好建表的SQL语句。</p>
<h3 id="1、对象关系映射ORM（Object-Relation-Mapping）概述"><a href="#1、对象关系映射ORM（Object-Relation-Mapping）概述" class="headerlink" title="1、对象关系映射ORM（Object Relation Mapping）概述"></a>1、对象关系映射ORM（Object Relation Mapping）概述</h3><h4 id="1-1、流行的ORM框架"><a href="#1-1、流行的ORM框架" class="headerlink" title="1.1、流行的ORM框架"></a>1.1、流行的ORM框架</h4><p>1、<strong>JPA</strong>：本身是一种<strong>ORM规范</strong>，不是ORM框架，<strong>由各大ORM框架提供实现</strong>。</p>
<p>2、<strong>Hibernate</strong>：<code>目前最流行的ORM框架</code>，设计灵巧，性能一般（并且开发人员不能够很好的控制性能），文档丰富。Hibernate是一个完整的ORM框架，常规CRUD我们不需要写一句SQL ( 完全自动操作 ) ；</p>
<p>3、<strong>MyBatis</strong>：原本是apache的一个开源项目iBatis，提供的持久层框架包括SQL Maps和Dao。MyBatis 并不是一个完整的ORM框架（或称“半自动”的ORM框架），因为我们还需要自己去写全部SQL，开发人员直接编写SQL(更好灵活)。</p>
<h4 id="1-2、JDBC操作数据库的缺陷"><a href="#1-2、JDBC操作数据库的缺陷" class="headerlink" title="1.2、JDBC操作数据库的缺陷"></a>1.2、JDBC操作数据库的缺陷</h4><p>首先，通过jdbc也能实现<strong>对象实体</strong>和<strong>数据库关系的映射</strong>。那就是采用硬编码方式，为每一种可能的数据库访问操作提供单独的方法， 也就是各种Dao (UserDao、DeptDao等)。</p>
<p>最大的缺点就是：</p>
<ol>
<li>SQL写在JAVA代码中，在修改SQL查询语句时，就连带着修改了Java代码，需要重新编译；</li>
<li>有很多重复性的操作（比如获取连接，释放资源等）。</li>
</ol>
<h4 id="1-3、ORM框架的操作数据库关系方式有许多种，常用的有两种"><a href="#1-3、ORM框架的操作数据库关系方式有许多种，常用的有两种" class="headerlink" title="1.3、ORM框架的操作数据库关系方式有许多种，常用的有两种"></a>1.3、ORM框架的操作数据库关系方式有许多种，常用的有两种</h4><h5 id="1、SQL操作方式-对JDBC进行轻量级封装的MyBatis框架实现"><a href="#1、SQL操作方式-对JDBC进行轻量级封装的MyBatis框架实现" class="headerlink" title="1、SQL操作方式 ( 对JDBC进行轻量级封装的MyBatis框架实现 )"></a>1、SQL操作方式 ( 对JDBC进行轻量级封装的MyBatis框架实现 )</h5><p>配置到配置文件中，通过不同中完成对象实体和数据库关系相互转换的操作。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.ProductMapper&quot;</span>&gt;</span></span><br><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;get&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;long&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span></span><br><span class="xml">		select * from product where id= #</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!--</span></span><br><span class="xml">		select : 这个标签里写查询语句</span><br><span class="xml">		id : 用来唯一确定这条查询语句</span><br><span class="xml">			未来用这条查询时由：namespace + . + id 的方式唯一确定这条查询</span><br><span class="xml">			如，cn.kongwei_liao.domain.ProductMapper.get</span><br><span class="xml">		parameterType : 传入的参数类型（long：Long、_long：long），具体数据库字段类型对应的高级程序语言类型参见文档</span><br><span class="xml">		resultType : 结果类型（第一条数据返回的对象类型），一定是cn.kongwei_liao.domain.Product这样的全限定类名</span><br><span class="xml">	--&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<h5 id="2、完整操作-JPA、Hibenate框架实现方式"><a href="#2、完整操作-JPA、Hibenate框架实现方式" class="headerlink" title="2、完整操作(JPA、Hibenate框架实现方式)"></a>2、完整操作(JPA、Hibenate框架实现方式)</h5><p>直接映射的是对象实体和数据库关系映射。操作数据库关系，不用写SQL由框架自己生成。</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203144714812.png" srcset="/img/loading.gif" alt="image-20191203144714812"></p>
<h5 id="3、MyBatis与Hibenate对比"><a href="#3、MyBatis与Hibenate对比" class="headerlink" title="3、MyBatis与Hibenate对比"></a>3、MyBatis与Hibenate对比</h5><p>MyBatis使用SQL语句对数据库进行操作的，所以单独对SQL语句进行优化，以提高查询效率，这点与Hibernate框架相比有很大优势，现阶段大部分的软件企业正逐步用MyBatis替换掉Hibernate。</p>
<p>更严格的来讲，MyBatis是一种“半自动化”的ORM框架，应该算作SQL映射框架（SQL mapper framework）。因为MyBatis操作数据库时还是使用的原始的SQL语句，这些语句仍要由程序员来自行设计。在使用上和全自动的ORM框架Hibernate有着非常大的区别，MyBatis是以SQL语句为映射基础，而Hibernate是彻底的基于实体类与表进行映射。正是由于MyBatis的半自动化特性，可以将SQL语句灵活多变的特性融入到项目的开发中。</p>
<p>。。。。。。</p>
<h4 id="1-4、ORM框架工作原理"><a href="#1-4、ORM框架工作原理" class="headerlink" title="1.4、ORM框架工作原理"></a>1.4、ORM框架工作原理</h4><p>1、以一定的映射方式，把实体模型和数据库关系的映射；</p>
<p>2、ORM框架启动时加载这些映射和数据库配置文件；</p>
<p>3、ORM通过对最原生JDBC的封装提供更加便利的操作API；</p>
<p>4、Dao通过ORM提供的便捷API以对象的方式操作数据库关系。</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203144903564.png" srcset="/img/loading.gif" alt="image-20191203144903564"></p>
<h3 id="3、MyBatis完成CRUD入门举例"><a href="#3、MyBatis完成CRUD入门举例" class="headerlink" title="3、MyBatis完成CRUD入门举例"></a>3、MyBatis完成CRUD入门举例</h3><p>准备步骤：<strong>导包</strong> –&gt; <strong>建表</strong> –&gt; <strong>domain(JavaBean)</strong> –&gt; <strong>准备Dao层(CRUD)</strong> –&gt; <strong>测试及业务代码中使用</strong></p>
<p>注意：我们要引哪些包?</p>
<ol>
<li>一定要引入JDBC驱动包；</li>
<li>导入MyBatis的核心包；</li>
<li>导入MyBatis的依赖包。</li>
</ol>
<h4 id="3-1、准备工作"><a href="#3-1、准备工作" class="headerlink" title="3.1、准备工作"></a>3.1、准备工作</h4><p>1、创建Java项目</p>
<p>2、导入所需的Jar包</p>
<p>MyBatis是一个持久层框架，在Java中框架就是一组Java类最后打成Jar包。所有使用的Java框架，使用前都要先导入相应 的Jar包。在导入jar包之前，我们得先说一下，MyBatis是操作数据库的框架。要操作数据库，还需要导入相应的数据库驱动包。注：数据库驱动包就是各大数据库厂商根据JDBC规范实现的jar包。</p>
<p>下图为我们使用MyBatis要导入的包：</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203145413871.png" srcset="/img/loading.gif" alt="image-20191203145413871"></p>
<p>如用Maven包管理工具管理项目，可在配置文件中加入如下依赖：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- mybatis版本号 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">mybatis.version</span>&gt;</span>3.2.8<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis.version</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-comment">&lt;!-- mysql驱动版本号 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">mysql-driver.version</span>&gt;</span>5.1.29<span class="hljs-tag">&lt;/<span class="hljs-name">mysql-driver.version</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-comment">&lt;!-- log4j日志包版本号 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">slf4j.version</span>&gt;</span>1.7.18<span class="hljs-tag">&lt;/<span class="hljs-name">slf4j.version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">log4j.version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">log4j.version</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- 添加mybatis依赖 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;mybatis.version&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>asm<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>asm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.javassist<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javassist<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.18.1-GA<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-comment">&lt;!-- 添加mysql驱动依赖 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;mysql-driver.version&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><br><span class="xml">    <span class="hljs-comment">&lt;!-- 添加日志相关jar包 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log4j.version&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;slf4j.version&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;slf4j.version&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>3、准备相应的数据库表</p>
<p>现在直接引入我们准备好的product表即可：</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203150151545.png" srcset="/img/loading.gif" alt="image-20191203150151545"></p>
<p>4、准备实体类JavaBean（domain层，不知道为什么是用domain这个词）</p>
<p>创建一个Product对象，对象属性 和数据库的 表中字段 对应；</p>
<p>注：类的名称  和  类型 都和我们的  Product表相对应匹配。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>&#123;<br>	<span class="hljs-keyword">private</span>	Long id;<span class="hljs-comment">//商品名称</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> productName;<span class="hljs-comment">//品牌</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> brand;<span class="hljs-comment">//供应商</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> supplier;<span class="hljs-comment">//零售价</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">Double</span> salePrice;<span class="hljs-comment">//进价</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">Double</span> costPrice;<span class="hljs-comment">//折扣比例</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">Double</span> cutoff;<span class="hljs-comment">//商品分类编号</span><br>	<span class="hljs-keyword">private</span> Long dir_id; <span class="hljs-comment">//提供getter与setter...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>5、Dao层准备</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 商品的持久操作</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IProductDao</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span>(<span class="hljs-params">Product p</span>)</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span>(<span class="hljs-params">Product p</span>)</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span>(<span class="hljs-params">Long id</span>)</span>;<br>	<span class="hljs-function">Product <span class="hljs-title">get</span>(<span class="hljs-params">Long id</span>)</span>;<br>	<span class="hljs-function">List&lt;Product&gt; <span class="hljs-title">getAll</span>(<span class="hljs-params"></span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="3-2、MyBatis核心配置文件"><a href="#3-2、MyBatis核心配置文件" class="headerlink" title="3.2、MyBatis核心配置文件"></a>3.2、MyBatis核心配置文件</h4><p>入门开始，介绍了MyBatis之后，就在提前知道MyBatis有一个核心对象：<code>SqlSessionFactory</code>，接下来要想方设法拿到这个核心对象。那我们如何拿到这个SqlSessionFactory对象？</p>
<ol>
<li>我们需要准备一个核心的xml文件；</li>
<li>拿到SqlSessionFactory之前需要读取核心的xml配置文件；</li>
<li>需要构造者(SqlSessionFactoryBuilder)来创建它。</li>
</ol>
<h5 id="1、准备核心的xml文件："><a href="#1、准备核心的xml文件：" class="headerlink" title="1、准备核心的xml文件："></a>1、准备核心的xml文件：</h5><p>数据库连接配置，映射文件位置的配置等。</p>
<p>资源文件加下面创建一个文件，命名为MyBatis-Config.xml</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="xml">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- 引入一个外部的Properties文件，如db.properties文件，该文件保存数据库连接属性，包括：驱动、数据库地址、数据库账号及密码 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;db.properties&quot;</span> /&gt;</span></span><br><span class="xml">    </span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span></span><br><span class="xml">    	<span class="hljs-comment">&lt;!-- alias:取的别名 --&gt;</span></span><br><span class="xml">    	<span class="hljs-comment">&lt;!-- type：这个别名所对应的Java类 ：别名使用的时候与大小写无关 --&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei-liao.domain.Department&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;Department&quot;</span>/&gt;</span></span><br><span class="xml">        </span><br><span class="xml">        <span class="hljs-comment">&lt;!-- 将一个包下面的所有类都取上别名:&lt;package name=&quot;cn.kongwei-liao.domain&quot; /&gt; --&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.kongwei-liao.domain&quot;</span>/&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span></span><br><span class="xml">    </span><br><br><span class="xml">    <span class="hljs-comment">&lt;!-- 环境们 (很多环境的意思)default:默认使用哪一个环境(必需对应一个环境的id) --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-comment">&lt;!-- 一个环境一个id:为这个环境取唯一一个id名称 --&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-comment">&lt;!-- 事务管理 type:JDBC(支持事务)/MANAGED(什么都不做) --&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-comment">&lt;!-- 数据源, 连接池 type(POOLED):MyBatis自带的连接池 --&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="xml">                <span class="hljs-comment">&lt;!-- 连接数据库的参数 --&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.driver&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.url&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.username&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.password&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!-- 这个mappers代表的是相应的ORM映射文件，添加映射文件的位置 --&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span></span><br><span class="xml">        <span class="hljs-comment">&lt;!-- 添加映射文件：1.前面不添加/，表示相对路径;2.使用的文件路径/,不是包路径. --&gt;</span></span><br><span class="xml">        <span class="hljs-comment">&lt;!-- 单表crud --&gt;</span></span><br><span class="xml">        <span class="hljs-comment">&lt;!-- &lt;mapper resource=&quot;cn/kongwei_liao/domain/ProductMapper.xml&quot; /&gt; --&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;cn/kongwei_liao/domain/ProductMapper.xml&quot;</span>/&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>Eclipse配置MyBatis-Config.xml提示信息，IDEA没整理不知道咋搞？？</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203152252675.png" srcset="/img/loading.gif" alt="image-20191203152252675"></p>
<h5 id="2、MyBatis核心配置标签的一个简单介绍："><a href="#2、MyBatis核心配置标签的一个简单介绍：" class="headerlink" title="2、MyBatis核心配置标签的一个简单介绍："></a>2、MyBatis核心配置标签的一个简单介绍：</h5><p>configuration：配置文件根标签；</p>
<p>environments：里面两个内容(<code>transactionManager</code>, <code>dataSource</code> )；</p>
<p>dataSource : <code>driver</code>, <code>url</code>, <code>username</code>, <code>password</code>(连接数据库的最小单位)；</p>
<p>mappers：mapper映射文件地址。</p>
<h5 id="3、抽取数据库信息-到-db-properties配置文件"><a href="#3、抽取数据库信息-到-db-properties配置文件" class="headerlink" title="3、抽取数据库信息 到 db.properties配置文件"></a>3、抽取数据库信息 到 db.properties配置文件</h5><p>关于数据库连接的信息已经在配置文件(XML)中，但是更多时候，我们还是会把配置文件的信息放到db.properties中。(由于properties的结构简单，便于修改，而这个文件只放数据库的连接信息也更好的体现了职责分离)。</p>
<p>其实，在官方文档的核心文件配置，就是直接使用的推荐的properties方式。</p>
<p>只需要我们做如下修改即可：</p>
<p>资源文件夹新建***.properties文件，如<strong>db.properties</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">db.driver</span>=com.mysql.jdbc.Driver<br><span class="hljs-attr">db.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/test<br><span class="hljs-attr">db.username</span>=root<br><span class="hljs-attr">db.password</span>=root<br></code></pre></td></tr></table></figure>
<p>MyBatis-Config.xml文件修改：用${…}符号引入db.properties中参数</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 引入Properties文件 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;db.properties&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="xml">				<span class="hljs-comment">&lt;!-- 根据key拿到properties中的value值 --&gt;</span></span><br><span class="xml">				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.driver&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.url&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.username&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;db.password&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span> </span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<h5 id="4、映射文件：对象与关系的映射"><a href="#4、映射文件：对象与关系的映射" class="headerlink" title="4、映射文件：对象与关系的映射"></a>4、映射文件：对象与关系的映射</h5><p>MyBatis是一个ORM映射框架，请问ORM体现在哪?</p>
<p>核心文件中有一个mappers,它指向了一个映射文件。映射文件在哪？</p>
<p>不是说好的MyBatis要写SQL语句么？SQL语句又在哪里？</p>
<p>如果直接写xml是没有提示了，在xml文件中加上约束的时候，xml就会有提示。</p>
<p>而现在使用的约束是通过网络访问，在Eclipse中，我们可以找到相应的约束文件，然后配置到自己本地即可。</p>
<p>直接找到我们文档中的探究已映射的SQL语句,在这里，我就可以看到一段xml(如下图)，这个xml就是咱们需要的映射文件，它就可以体现出ORM，并且在这里面，也可以愉快的写sql语句了。</p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191203155111232.png" srcset="/img/loading.gif" alt="image-20191203155111232"></p>
<p>在这里，我们可以看懂一些配置的意思，但是也有一些东西不是很明白。在下面的实例中，我已经对每一句配置准备好了相应的解释：</p>
<p>cn/kongwei_liao/domain/ProductMapper.xml文件如下：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="xml">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><br><span class="xml"><span class="hljs-comment">&lt;!--公共查询句：可由include标签引入--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;rootsql&quot;</span>&gt;</span></span><br><span class="xml">	select * from product</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-------------------------------------------------------------------------------------&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!--</span></span><br><span class="xml">	这个Mapper的主要功能就是写sql</span><br><span class="xml">	mapper:根</span><br><span class="xml">	namespace:命令空间 (用来确定唯一) 以前这个是可以不加的,现在必需加</span><br><span class="xml">	namespace的值，规则的：映射文件XxxMapper.xml所在的包+domain类名+Mapper</span><br><span class="xml"> --&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.ProductMapper&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- 固定书写方法 --&gt;</span></span><br><span class="xml">    <span class="hljs-comment">&lt;!--</span></span><br><span class="xml">        select : 这里面写查询语句</span><br><span class="xml">        id:用来确定这条sql语句的唯一</span><br><span class="xml">               以后我们确定唯一,也就是找sql语句 : namespace + . + id</span><br><span class="xml">             例: cn.kongwei_liao.domain.ProductMapper.get</span><br><span class="xml">        parameterType : 传入的参数类型  long:大Long  _long:小long (具体的对应请参见文档)</span><br><span class="xml">        resultType : 结果类型(第一条数据返回的对象类型) 自己的对象，一定是cn.kongwei_liao.domain.Product这样的全限定类名</span><br><span class="xml">     --&gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!--include refid=&quot;rootsql&quot;&gt;&lt;/include--&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!--OR--&gt;</span></span><br><span class="xml">		select * from product</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;long&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;rootsql&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span></span><br><span class="xml">		where id = #</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectByNameAndId&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee_department_role&quot;</span> &gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;rootsql&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span></span><br><span class="xml">		where  productname=#</span><span class="hljs-template-variable">&#123;0&#125;</span><span class="xml"> and productid=#</span><span class="hljs-template-variable">&#123;1&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;searchByProductName&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span></span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;rootsql&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span></span><br><span class="xml">		where productname like &#x27;%$</span><span class="hljs-template-variable">&#123;productname&#125;</span><span class="xml">%&#x27;</span><br><span class="xml">		<span class="hljs-comment">&lt;!-- 若方法传参名于$or#</span></span><span class="hljs-template-variable">&#123;&#125;</span><span class="xml"><span class="hljs-comment">中的不匹配，在方法的传入的参数类型前加@Param(&quot;$or#</span></span><span class="hljs-template-variable">&#123;&#125;</span><span class="xml"><span class="hljs-comment">中的名字&quot;) --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span></span><br><span class="xml">		insert into product(productName,salePrice,costPrice,cutoff,supplier,brand,dir_id)</span><br><span class="xml">		values</span><br><span class="xml">		(#</span><span class="hljs-template-variable">&#123;productName&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;salePrice&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;costPrice&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;cutoff&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;supplier&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;brand&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;dir_id&#125;</span><span class="xml">)</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span></span><br><span class="xml">		update product set productName=#</span><span class="hljs-template-variable">&#123;productName&#125;</span><span class="xml">,salePrice=#</span><span class="hljs-template-variable">&#123;salePrice&#125;</span><span class="xml">,costPrice=#</span><span class="hljs-template-variable">&#123;costPrice&#125;</span><span class="xml">,</span><br><span class="xml">		cutoff=#</span><span class="hljs-template-variable">&#123;cutoff&#125;</span><span class="xml">,supplier=#</span><span class="hljs-template-variable">&#123;supplier&#125;</span><span class="xml">,brand=#</span><span class="hljs-template-variable">&#123;brand&#125;</span><span class="xml">,dir_id=#</span><span class="hljs-template-variable">&#123;dir_id&#125;</span><br><span class="xml">		where id=#</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;delete&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Long&quot;</span>&gt;</span></span><br><span class="xml">		delete from product where id=#</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<h4 id="3-3、上述映射配置文件的规范及注意事项"><a href="#3-3、上述映射配置文件的规范及注意事项" class="headerlink" title="3.3、上述映射配置文件的规范及注意事项"></a>3.3、上述映射配置文件的规范及注意事项</h4><p>① 我们的映射文件一般情况下是放在 <code>resources类型目录下</code> 和它对应的<code>domain</code>在同一个层级；</p>
<p>② 这个映射文件的名称一般叫做 XxxMapper.xml (Xxx代表的是实体类名称)；</p>
<p>③ namespace的名称为了确定唯一性，应按推荐要求取名：</p>
<p>​    如我们有一个类：</p>
<p>​        cn.kongwei_liao.domain.Product / cn.kongwei_liao.domain.Student</p>
<p>​    那这里取名应该是：</p>
<p>​        cn.kongwei_liao.domain.ProductMapper / cn.kongwei_liao.domain.StudentMapper</p>
<p>④ 除了MyBatis支持的类型，其它的类型都通通使用<code>全限定名</code> ；</p>
<p>⑤ 如果将映射文件与实体类放在一起，运行时会遇到访问不到这个映射文件资源错误（放到resources类型目录下就不会出现这种情况），可能是因为资源路径不可达，可在pom.xml文件中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- build标签内 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>	<br>	<span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><span class="hljs-comment">&lt;!--关键配置--&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h4 id="3-4、完成数据的CRUD"><a href="#3-4、完成数据的CRUD" class="headerlink" title="3.4、完成数据的CRUD"></a>3.4、完成数据的CRUD</h4><p>核心配置文件有了，映射文件也有了，现在就可以完成数据库的CRUD了。首先需要获取的是核心对象SqlSessionFactory，然后通过它去拿到一个SqlSession对象(相当于JDBC的连接)。必需要有SqlSession这个对象，我们才可以去执行相应的SQL。</p>
<h5 id="1、SqlSession对象的获取"><a href="#1、SqlSession对象的获取" class="headerlink" title="1、SqlSession对象的获取"></a>1、SqlSession对象的获取</h5><p>官方文档从XML 中构建 SqlSessionFactory这一章中，除了配置的核心xml，在上面我们还可以看到几句代码(如下图)，现在咱们就来详细分析一下这几句代码是什么意思：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">private</span> static SqlSessionFactory sqlSessionFactory;<br>Reader reader = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Resources</span>.</span></span>get<span class="hljs-constructor">ResourceAsReader(<span class="hljs-string">&quot;MyBatis-Config.xml&quot;</span>)</span>;<br>sqlSessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SqlSessionFactoryBuilder()</span>.build(reader);<br></code></pre></td></tr></table></figure>
<p>我们简单解释一下上面的代码：读取核心配置文件，然后再通过SqlSessionFactoryBuilder构建者来创建一个SqlSessionFactory对象。</p>
<p>注：上面的SqlSession对象是一个通过SqlSessionFactory工厂对象返回的对象:</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function">SqlSession <span class="hljs-title">getSession</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">return</span> sqlSessionFactory.<span class="hljs-title">openSession</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h5 id="2、获取SqlSession的工具类（MyBatisUtils）抽取"><a href="#2、获取SqlSession的工具类（MyBatisUtils）抽取" class="headerlink" title="2、获取SqlSession的工具类（MyBatisUtils）抽取"></a>2、获取SqlSession的工具类（MyBatisUtils）抽取</h5><p>对于MyBatis的工具类抽取，直接使用静态工具的单例模式。</p>
<p>注：几种单例模式的区别与使用(单例工具与静态工具的区别)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><br><span class="hljs-keyword">import</span> java.io.Reader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisUtils</span> </span>&#123;<br>    <span class="hljs-comment">// 保证SqlSessionFactory是单例</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sqlSessionFactory;<br><br>    <span class="hljs-comment">// SqlSessionFactory类似于JPA的EntityManagerFactory，Hibernate的SessionFactory</span><br>    <span class="hljs-comment">// SqlSession 类似于JPA的EntityManager，Hibernate的Session</span><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Reader reader = Resources.getResourceAsReader(<span class="hljs-string">&quot;MyBatis-Config.xml&quot;</span>);<br>            sqlSessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(reader);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;解析MyBatis的配置文件或者映射文件出现异常：&quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 对外提供一个返回SqlSession对象的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title">getSession</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="3、查询一条数据"><a href="#3、查询一条数据" class="headerlink" title="3、查询一条数据"></a><strong>3、查询一条数据</strong></h5><p>大家要注意咱们传过去的参数，还有在SQL接收的参数！</p>
<p>传过去的<code>变量名称</code>和<code>#里面的字符串名称</code>不是一回事！</p>
<p>整个MyBatis的流程再进行一次分析：</p>
<ol>
<li><p>我们需要核心文件(提供联系数据库的环境)</p>
</li>
<li><p>需要映射文件(提供ORM与运行的SQL语句)</p>
</li>
<li><p>拿到SqlSession对象，用于执行SQL</p>
</li>
</ol>
<p>ProductDaoImp.java</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String NAME_SPACE = <span class="hljs-string">&quot;cn.kongwei_liao.domain.ProductMapper.&quot;</span>;<span class="hljs-comment">//NAME_SPACE怎么写????  最后需要有个点</span><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-function">Product <span class="hljs-title">get</span><span class="hljs-params">(Long id)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        sqlSession = MyBatisUtils.getSession();<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> sqlSession.<span class="hljs-title">selectOne</span><span class="hljs-params">(NAME_SPACE + <span class="hljs-string">&quot;getById&quot;</span>, id)</span></span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ProductDaoImpl.get出现异常：&quot;</span> + e.getMessage());<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-keyword">null</span>) &#123;<br>            sqlSession.close();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="4、junit测试（有必要的）"><a href="#4、junit测试（有必要的）" class="headerlink" title="4、junit测试（有必要的）"></a>4、junit测试（有必要的）</h5><p>写代码过程中进行测试是一个好习惯。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductDaoTest</span> &#123;</span><br>	IProductDao productDao = <span class="hljs-keyword">new</span> ProductDaoImpl();<br>	@Test<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGet</span><span class="hljs-params">()</span> </span>&#123;<br>		Product product = productDao.<span class="hljs-built_in">get</span>(<span class="hljs-number">1L</span>);<br>		System.out.<span class="hljs-built_in">println</span>(product);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="5、查询所有数据"><a href="#5、查询所有数据" class="headerlink" title="5、查询所有数据"></a>5、查询所有数据</h5><p>代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-function"><span class="hljs-title">getAll</span>(<span class="hljs-params"></span>)</span> &#123;<br>	SqlSession sqlSession = <span class="hljs-literal">null</span>;<br>	<span class="hljs-keyword">try</span> &#123;<br>		sqlSession = MyBatisUtils.getSession();<br>		<span class="hljs-keyword">return</span> sqlSession.selectList(NAME_SPACE + <span class="hljs-string">&quot;getAll&quot;</span>);<br>	&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>		e.printStackTrace();<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ProductDaoImpl.get出现异常：&quot;</span> + e.getMessage());<br>	&#125; <span class="hljs-keyword">finally</span> &#123;<br>		<span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>			sqlSession.close();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs fortran">@Test<br><span class="hljs-keyword">public</span> void testGetAll() &#123;<br>	List&lt;<span class="hljs-built_in">Product</span>&gt; list = productDao.getAll();<br>	for (<span class="hljs-built_in">Product</span> <span class="hljs-built_in">product</span> : list) &#123;<br>		System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">product</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="6、添加数据"><a href="#6、添加数据" class="headerlink" title="6、添加数据"></a>6、添加数据</h5><p>注：添加的时候一定要记住提交事务 ( 配置事务、表结构支持事务 );</p>
<p><code>JDBC的事务是自动提交的，而JPA、Hibernate、MyBatis事务都是需要手动提交的。</code></p>
<p>代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">save</span>(<span class="hljs-params">Product product</span>)</span> &#123;<br>	SqlSession sqlSession = <span class="hljs-literal">null</span>;<br>	<span class="hljs-keyword">try</span> &#123;<br>		sqlSession = MyBatisUtils.getSession();<br>		sqlSession.insert(NAME_SPACE + <span class="hljs-string">&quot;save&quot;</span>, product);<br>		<br>		<span class="hljs-comment">// JDBC的事务是自动提交的，而JPA、Hibernate、MyBatis事务都是需要手动提交的</span><br>		sqlSession.commit();<br>	&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>		e.printStackTrace();<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ProductDaoImpl.get出现异常：&quot;</span> + e.getMessage());<br>	&#125; <span class="hljs-keyword">finally</span> &#123;<br>		<span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>			sqlSession.close();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs fortran">@Test<br><span class="hljs-keyword">public</span> void testSave() &#123;<br>	<span class="hljs-built_in">Product</span> <span class="hljs-built_in">product</span> = new <span class="hljs-built_in">Product</span>();<br>	<span class="hljs-built_in">product</span>.setBrand(<span class="hljs-string">&quot;大力牌&quot;</span>);<br>	<span class="hljs-built_in">product</span>.setCostPrice(<span class="hljs-number">30.0</span>);<br>	<span class="hljs-built_in">product</span>.setCutoff(<span class="hljs-number">0.8</span>);<br>	<span class="hljs-built_in">product</span>.setDir_id(<span class="hljs-number">1</span>L);<br>	<span class="hljs-built_in">product</span>.setProductName(<span class="hljs-string">&quot;000000&quot;</span>);<br>	<span class="hljs-built_in">product</span>.setSalePrice(<span class="hljs-number">60</span>D);<br>	<span class="hljs-built_in">product</span>.setSupplier(<span class="hljs-string">&quot;东莞供应商&quot;</span>);<br>	productDao.<span class="hljs-keyword">save</span>(<span class="hljs-built_in">product</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>添加数据的有时候咱们需要拿到当前数据的主键。咱们先移步到MyBatis细节一章的拿到返回主键部分！下一章</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!-- 可选择性插入 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertSelective&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span></span></span><br><span class="xml">        useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">        insert into product</span><br><span class="xml">        product(productName,salePrice,costPrice,cutoff,supplier,brand,dir_id)</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="xml">                id,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;productName != null&quot;</span>&gt;</span></span><br><span class="xml">                vid,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;salePrice != null&quot;</span>&gt;</span></span><br><span class="xml">                ntype,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;costPrice != null&quot;</span>&gt;</span></span><br><span class="xml">                canentry,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;supplier != null&quot;</span>&gt;</span></span><br><span class="xml">                title,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brand != null&quot;</span>&gt;</span></span><br><span class="xml">                ispush,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dir_id != null&quot;</span>&gt;</span></span><br><span class="xml">                entrycount,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;values (&quot;</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;id,jdbcType=INTEGER&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;productName != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;productName,jdbcType=VARCHAR&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;salePrice != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;salePrice,jdbcType=TINYINT&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;costPrice != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;costPrice,jdbcType=TINYINT&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;cutoff != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;cutoff,jdbcType=VARCHAR&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;supplier != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;supplier,jdbcType=TINYINT&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brand != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;brand,jdbcType=VARCHAR&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dir_id != null&quot;</span>&gt;</span></span><br><span class="xml">                #</span><span class="hljs-template-variable">&#123;dir_id,jdbcType=INTEGER&#125;</span><span class="xml">,</span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<h5 id="7、修改数据"><a href="#7、修改数据" class="headerlink" title="7、修改数据"></a>7、修改数据</h5><p>代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">update</span>(<span class="hljs-params">Product product</span>)</span> &#123;<br>	SqlSession sqlSession = <span class="hljs-literal">null</span>;<br>	<span class="hljs-keyword">try</span> &#123;<br>		sqlSession = MyBatisUtils.getSession();<br>		sqlSession.update(NAME_SPACE + <span class="hljs-string">&quot;update&quot;</span>, product);<br>		<br>		<span class="hljs-comment">// JDBC的事务是自动提交的，而JPA、Hibernate、MyBatis事务都是需要手动提交的</span><br>		sqlSession.commit();<br>	&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>		e.printStackTrace();<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ProductDaoImpl.get出现异常：&quot;</span> + e.getMessage());<br>	&#125; <span class="hljs-keyword">finally</span> &#123;<br>		<span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>			sqlSession.close();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs fortran">@Test<br><span class="hljs-keyword">public</span> void testUpdate() &#123;<br>	<span class="hljs-built_in">Product</span> <span class="hljs-built_in">product</span> = productDao.get(<span class="hljs-number">1</span>L);<br>	System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">product</span>);<br>	<br>	<span class="hljs-built_in">product</span>.setBrand(<span class="hljs-string">&quot;大力牌&quot;</span>);<br>	<span class="hljs-built_in">product</span>.setCostPrice(<span class="hljs-number">30.0</span>);<br>	<span class="hljs-built_in">product</span>.setCutoff(<span class="hljs-number">0.8</span>);<br>	<span class="hljs-built_in">product</span>.setDir_id(<span class="hljs-number">1</span>L);<br>	<span class="hljs-built_in">product</span>.setProductName(<span class="hljs-string">&quot;000000&quot;</span>);<br>	<span class="hljs-built_in">product</span>.setSalePrice(<span class="hljs-number">60</span>D);<br>	<span class="hljs-built_in">product</span>.setSupplier(<span class="hljs-string">&quot;东莞供应商&quot;</span>);<br>	productDao.update(<span class="hljs-built_in">product</span>);<br>	<br>	<span class="hljs-built_in">product</span> = productDao.get(<span class="hljs-number">1</span>L);<br>	System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">product</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="8、删除一条数据"><a href="#8、删除一条数据" class="headerlink" title="8、删除一条数据"></a>8、删除一条数据</h5><p>代码：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-keyword">delete</span>(Long id) &#123;<br>	SqlSession sqlSession = <span class="hljs-literal">null</span>;<br>	<span class="hljs-keyword">try</span> &#123;<br>		sqlSession = MyBatisUtils.getSession();<br>		sqlSession.<span class="hljs-keyword">delete</span>(NAME_SPACE + <span class="hljs-string">&quot;delete&quot;</span>, id);<br>		<span class="hljs-comment">// JDBC的事务是自动提交的，而JPA、Hibernate、MyBatis事务都是需要手动提交的</span><br>		sqlSession.commit();<br>	&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>		e.printStackTrace();<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ProductDaoImpl.delete出现异常：&quot;</span> + e.getMessage());<br>	&#125; <span class="hljs-keyword">finally</span> &#123;<br>		<span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>			sqlSession.close();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino">@Test<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span> </span>&#123;<br>	productDao.<span class="hljs-keyword">delete</span>(<span class="hljs-number">1L</span>);<br>	Product product = productDao.<span class="hljs-built_in">get</span>(<span class="hljs-number">1L</span>);<br>	System.out.<span class="hljs-built_in">println</span>(product);<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="9、CRUD注意事项"><a href="#9、CRUD注意事项" class="headerlink" title="9、CRUD注意事项"></a>9、CRUD注意事项</h5><p>下面是在使用MyBatis的时候经常出现的问题，需要引起重视。出现问题的时候过来好好的来找。基本咱们使用MyBatis中出的错都在这里。</p>
<p>使用框架的时候配置信息变多，在配置里写的都是字符串，而且经常是要对应的。因为，这里希望大家要切记：写的时候细心，出现错误找字符串要耐心，</p>
<ol>
<li>主配置中未配置相应的mapper（当然，这个路径也可能写错）；</li>
<li>在代码中调用Sql的时候路径写错；</li>
<li>Sql写错，这个应该还好找；</li>
<li>当我们在配置文件中很多地方如果写错，即便是你还没有使用也可能会报错；</li>
<li>写Sql的标签不需要全部一致（如添加不一定必需使用insert），但是它的属性会不同；</li>
<li>在传入与返回参数时全限定类名写错。</li>
</ol>
<p>在开发的时候，要边做边测试。 在某一步出现错误后，删除新加的代码看有没有问题，如果删除部分代码后运行成功，就相应的可以缩小排错的范围。</p>
<h3 id="4、MyBatis三大核心对象介绍，及其生命周期"><a href="#4、MyBatis三大核心对象介绍，及其生命周期" class="headerlink" title="4、MyBatis三大核心对象介绍，及其生命周期"></a>4、MyBatis三大核心对象介绍，及其生命周期</h3><h4 id="4-1、SqlSessionFactoryBuilder"><a href="#4-1、SqlSessionFactoryBuilder" class="headerlink" title="4.1、SqlSessionFactoryBuilder"></a>4.1、SqlSessionFactoryBuilder</h4><p>建造者模式：我们最后拿到的这个对象是非常复杂的。用这个建造者就它先为我们把这些复杂的代码完成。</p>
<p>这个类可以被实例化，使用和丢弃。<strong>一旦你创建了SqlSessionFactory后，这个SqlSessionFactoryBuilder类就不需要存在了。</strong>因此SqlSessionFactoryBuilder实例的最佳范围是方法范围（也就是本地方法变量）。</p>
<p>你可以重用SqlSessionFactoryBuilder来创建多个SqlSessionFactory实例，但是最好的方式是</p>
<p>不需要保持它一直存在来保证所有XML解析资源，因为还有更重要的事情要做。 </p>
<h4 id="4-2、SqlSessionFactory"><a href="#4-2、SqlSessionFactory" class="headerlink" title="4.2、SqlSessionFactory"></a>4.2、SqlSessionFactory</h4><p>类似于JPA的EntityManagerFactory，Hibernate的SessionFactory</p>
<p><strong>一旦被创建，SqlSessionFactory应该在你的应用执行期间都存在。</strong>没有理由来处理或重新创建它。使用SqlSessionFactory的最佳实践是在应用运行期间不要重复创建多次。这样的操作将被视为是非常糟糕的，因此SqlSessionFactory的最佳范围是应用范围。</p>
<p>有很多方法可以做到，最简单的就是<code>使用单例模式</code>或者<code>静态单例模式</code>。然而这两种方法都不认为是最佳实践。这样的话，你可以<strong>考虑依赖注入容器，比如Google Guice或Spring。这样的框架允许你创建支持程序来管理单例SqlSessionFactory的生命周期。</strong> </p>
<h4 id="4-3、SqlSession"><a href="#4-3、SqlSession" class="headerlink" title="4.3、SqlSession"></a>4.3、SqlSession</h4><p>类似于JPA的EntityManager，Hibernate的Session</p>
<p><strong>每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能被共享，也是线程不安全的。</strong>因此最佳的范围是请求或方法范围。</p>
<p>绝对不能将SqlSession实例的引用放在一个类的静态字段甚至是实例字段中。</p>
<p>也绝不能将SqlSession实例的引用放在任何类型的管理范围中，比如Serlvet架构中的HttpSession。</p>
<p>如果你现在正用任意的Web框架，要考虑SqlSession放在一个和HTTP请求对象相似的范围内。换句话说，基于收到的HTTP请求，你可以打开了一个SqlSession，然后返回响应，就可以关闭它了。关闭Session很重要！</p>
<p>为什么在这里我们要先说这三大核心对象呢，因为在我们必需要了解这三个对象的特性。才可以更好的根据这个特性来完成MyBatisUtils工具类代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><br><span class="hljs-keyword">import</span> java.io.Reader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisUtils</span> </span>&#123;<br>    <span class="hljs-comment">// 保证SqlSessionFactory是单例</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sqlSessionFactory;<br><br>    <span class="hljs-comment">// SqlSessionFactory类似于JPA的EntityManagerFactory，Hibernate的SessionFactory</span><br>    <span class="hljs-comment">// SqlSession 类似于JPA的EntityManager，Hibernate的Session</span><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Reader reader = Resources.getResourceAsReader(<span class="hljs-string">&quot;MyBatis-Config.xml&quot;</span>);<br>            sqlSessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(reader);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;解析MyBatis的配置文件或者映射文件出现异常：&quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 对外提供一个类</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title">getSession</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="5、MyBatis的使用细节"><a href="#5、MyBatis的使用细节" class="headerlink" title="5、MyBatis的使用细节"></a>5、MyBatis的使用细节</h3><h4 id="5-1、添加时拿到返回的主键"><a href="#5-1、添加时拿到返回的主键" class="headerlink" title="5.1、添加时拿到返回的主键"></a>5.1、添加时拿到返回的主键</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!-- </span></span><br><span class="xml">	parameterType：		需要传入我们的对象;</span><br><span class="xml">	useGeneratedKeys:	 是否需要主键;</span><br><span class="xml">	keyColumn:			主键所在的表字段（列），可以不用配置;</span><br><span class="xml">	keyProperty:		Java对象中的属性 (代表主键的那个属性)。</span><br><span class="xml"> --&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span></span></span><br><span class="xml">		useGeneratedKeys=&quot;true&quot; </span><br><span class="xml">		keyColumn=&quot;id&quot;</span><br><span class="xml">		keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">	insert into product (productName,dir_id,salePrice,supplier,brand,cutoff,costPrice)</span><br><span class="xml">	values (#</span><span class="hljs-template-variable">&#123;productName&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;dir_id&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;salePrice&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;supplier&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;brand&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;cutoff&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;costPrice&#125;</span><span class="xml">)</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>上述的插入操作，没有进行主键的插入，再插入这条记录时主键以递增的方式插入记录。MyBatis会自动把这个主键set到对象的属性上。</p>
<h4 id="5-2、Log4j日志框架"><a href="#5-2、Log4j日志框架" class="headerlink" title="5.2、Log4j日志框架"></a>5.2、Log4j日志框架</h4><p>在使用MyBatis的很多时候，我们可能需要把日志打印出来，帮助我们进行分析与排错。</p>
<p>打开后我们可以看到执行的SQL语句，可以看到我们传递的参数。</p>
<p>而MyBatis中打印日志使用的是Log4j。</p>
<p>1、Log4j简介</p>
<p>Log4j有三个主要的组件：<code>Loggers（记录器）</code>，<code>Appenders（输出源）</code>和 <code>Layouts（布局）</code>。</p>
<p>可简单理解为<code>日志类别</code>，日志<code>要输出的地方</code>和日志<code>以何种形式输出</code>。综合使用这三个组件可以轻松地记录<code>信息的类型</code>和<code>级别</code>，并可以在运行时<code>控制日志输出的样式和位置</code>。</p>
<p>2、日志等级</p>
<blockquote>
<p>等级从低到高</p>
<ol>
<li><p>TRACE：详细</p>
</li>
<li><p>DEBUG：调试，类似于System.out.print</p>
</li>
<li><p>INFO：信息，类似于JPA打印sql等级</p>
</li>
<li><p>WARN：警告，程序可以正常运行，出现提示</p>
</li>
<li><p>ERROR：错误，出现异常</p>
</li>
</ol>
</blockquote>
<p>3、log4j.properties</p>
<p>要在项目中打开日志，在资源文件根目录下创建一个log4j.properties的文件，并把下面的代码拷备到里面。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">log4j.rootLogger</span>=ERROR, STDOUT<br><span class="hljs-comment">#log4j.rootLogger=NONE</span><br><span class="hljs-attr">log4j.logger.cn.kongwei_liao</span>=TRACE   <span class="hljs-comment">#把左边包名改成你自己的包名</span><br><br><span class="hljs-attr">log4j.appender.stdout</span>=org.apache.log4j.ConsoleAppender<br><span class="hljs-attr">log4j.appender.stdout.layout</span>=org.apache.log4j.PatternLayout<br><span class="hljs-attr">log4j.appender.stdout.layout.ConversionPattern</span>=%d %p [%c] - %m%n<br></code></pre></td></tr></table></figure>
<p>注意：cn.kongwei_liao：一定要根据自己的包名情况进行修改。</p>
<p>如果配置成功，那么在MyBatis运行操作数据时就可以看到相应的日志了。</p>
<h4 id="5-3、MyBatis中为一个类取别名"><a href="#5-3、MyBatis中为一个类取别名" class="headerlink" title="5.3、MyBatis中为一个类取别名"></a>5.3、MyBatis中为一个类取别名</h4><p>别名：分两种 –&gt; <code>内置别名</code>和<code>自定义别名</code></p>
<p><img src="Mybatis-%E5%9F%BA%E7%A1%80/image-20191211110636317.png" srcset="/img/loading.gif" alt="image-20191211110636317"></p>
<p>自定义别名：</p>
<p>在我们前面传参与接收结果的时候，咱们一直是使用的全限定名；</p>
<p>但是MyBatis自己在使用很多自己的内置类型的时候（如Integer，Boolean）却可以直接使用别名；</p>
<p>那么，咱们自己的写的类能不能使用别名呢？当然可以，看下面的案例：</p>
<p>取别名有什么用？我认识一个朋友，他叫做：特雷西 · 麦克格雷迪，我叫他麦迪。</p>
<p>下面为取别名的代码：</p>
<p>在MyBatis-Config.xml配置文件中配置别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">			1、将一个包下面的所有类都取上别名:&lt;package name=&quot;cn.kongwei_liao.domain&quot;，别名就是类名。/&gt;</span><br><span class="hljs-comment">			2、单独的为各JavaBean实体类取别名</span><br><span class="hljs-comment">				alias:取的别名</span><br><span class="hljs-comment">				type：这个别名所对应的Java类</span><br><span class="hljs-comment">			3、别名使用的时候与大小写无关</span><br><span class="hljs-comment">		 --&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 配置繁琐很少使用 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;product&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span> /&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 做项目的时候使用 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>Spring集成项目中的applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br>	... ...<br>	<span class="hljs-comment">&lt;!--别名的配置:domain query--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;edu.zzu.domain,edu.zzu.query&quot;</span>/&gt;</span><br>	<span class="hljs-comment">&lt;!--&lt;property name=&quot;typeAliases&quot;  value=&quot;&quot;/&gt;--&gt;</span><br>	... ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>注：必需在主配置文件中设置别名，其它地方（如映射文件中）才可以使用（切记！切记！）。</p>
<h4 id="5-4、列名与属性名不对应的解决resultMap"><a href="#5-4、列名与属性名不对应的解决resultMap" class="headerlink" title="5.4、列名与属性名不对应的解决resultMap"></a>5.4、列名与属性名不对应的解决resultMap</h4><p>之前做映射文件的时候，只做了<code>数据库表</code>与<code>Java对象</code>之间的联系。并没有做<code>表字段</code>与<code>Java对象属性</code>之间的联系。它们之间是如何联系的？</p>
<p><strong>由于之前咱们的  <code>数据库表字段名</code> 与  <code>JavaBean属性名</code> 是一致的，因此MyBatis框架可以对此进行自动识别。</strong></p>
<p><strong>那么：</strong>如果咱们的  列名  与  Java对象属性名  不一致了 ( 对应不上 )，这时候应该怎么办呢？</p>
<p>这时候，就需要我们开发人员告诉MyBatis框架，我们需要把哪些字段名与属性名对应上。</p>
<p>在MyBatis中，提供了一个<code>resultMap的标签</code>，就是让我们来<code>完成返回结果的关系对应</code>的，使用方式如下：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!-- </span></span><br><span class="xml">	返回的数据映射 </span><br><span class="xml">		type：代表是要映射的对象</span><br><span class="xml">		id：代表唯一(过会我们要拿到它)</span><br><span class="xml">--&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="xml">	<span class="hljs-comment">&lt;!-- </span></span><br><span class="xml">		column:		 数据库表中的列名</span><br><span class="xml">		property:	 JavaBean中的属性名</span><br><span class="xml">	 --&gt;</span><br><span class="xml">	 </span><br><span class="xml">	<span class="hljs-comment">&lt;!-- product表主键为id，对应Product对象中的id属性 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>  /&gt;</span>	</span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 其他表字段，与Product对象中属性对应 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;productName&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span>	</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>	</span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryOne&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;long&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="xml">	select * from product where id = #</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<h3 id="6、常见异常"><a href="#6、常见异常" class="headerlink" title="6、常见异常"></a>6、常见异常</h3><ol>
<li><p>java.lang.ClassNotFoundException: Cannot find class: id</p>
<p>&lt;delete id=”delete” parameterType=”id”&gt;    应该传入long类型，而不是id；</p>
</li>
<li><p>Caused by: org.xml.sax.SAXParseException; lineNumber: 23; columnNumber: 4</p>
<p>元素类型 “select” 必须由匹配的结束标记 “&lt;/select&gt;” 终止；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- select标签开始，insert标签结束导致的错误 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Product&quot;</span>&gt;</span><br>	select id,productName,salePrice,costPrice,cutoff,supplier,brand,dir_id from<br>	product<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>Caused by: java.lang.IllegalArgumentException: Mapped Statements collection does not contain value for cn.kongwei_liao.domain.ProductMapper.get</p>
<p>配置文件里面没有匹配的映射关系（错误映射，或未映射）；</p>
</li>
<li><p>Caused by: org.apache.ibatis.reflection.ReflectionException: There is no getter for property named ‘productName’ in ‘class cn.kongwei_liao.domain.Product’</p>
<p>Product 类里面没有 ‘productName’ 这个属性。</p>
</li>
</ol>
<h3 id="7、常见问题"><a href="#7、常见问题" class="headerlink" title="7、常见问题"></a>7、常见问题</h3><ol>
<li>   没有导入数据库的驱动包；</li>
<li>   在XML中很多都是字符串，细心，不要写错；</li>
<li>   在映射文件中全限定类名可能会写错；</li>
<li>   找不到相应的Statement(sql语句)；</li>
<li>   找SQL的Statement写错了；</li>
<li>   在核心XML中没有找相应的映射文件；</li>
<li>   在我们调用Statement（sql语句）的时候，经常会忘记传参；</li>
<li>   执行成功后，数据库却没有反映，很有可能是没有提交事务；</li>
<li>   可能我们忘了写执行的代码了；</li>
<li>   错误一定要打印出来（执行的时候没效果，但是又不报错）；</li>
<li>   Mapper中就算一个语句没有使用，它的错也可能会影响到其它正确的语句；</li>
<li>   框架的错往往从后向前找；</li>
<li>   使用未定义的别名；</li>
<li>   Mysql乱码，添加字符编码、设置时区：useUnicode=true&amp;characterEncoding=UTF-8。</li>
</ol>
<h3 id="8、JDBC类型与Java类型对照"><a href="#8、JDBC类型与Java类型对照" class="headerlink" title="8、JDBC类型与Java类型对照"></a>8、JDBC类型与Java类型对照</h3><table>
<thead>
<tr>
<th align="left"><strong>JDBC 类型</strong></th>
<th align="left"><strong>Java 类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CHAR</code></td>
<td align="left"><code>String</code></td>
</tr>
<tr>
<td align="left"><code>VARCHAR</code></td>
<td align="left"><code>String</code></td>
</tr>
<tr>
<td align="left"><code>LONGVARCHAR</code></td>
<td align="left"><code>String</code></td>
</tr>
<tr>
<td align="left"><code>NUMERIC</code></td>
<td align="left"><code>java.math.BigDecimal</code></td>
</tr>
<tr>
<td align="left"><code>DECIMAL</code></td>
<td align="left"><code>java.math.BigDecimal</code></td>
</tr>
<tr>
<td align="left"><code>BIT</code></td>
<td align="left"><code>boolean</code></td>
</tr>
<tr>
<td align="left"><code>TINYINT</code></td>
<td align="left"><code>byte</code></td>
</tr>
<tr>
<td align="left"><code>SMALLINT</code></td>
<td align="left"><code>short</code></td>
</tr>
<tr>
<td align="left"><code>INTEGER</code></td>
<td align="left"><code>int</code></td>
</tr>
<tr>
<td align="left"><code>BIGINT</code></td>
<td align="left"><code>long</code></td>
</tr>
<tr>
<td align="left"><code>REAL</code></td>
<td align="left"><code>float</code></td>
</tr>
<tr>
<td align="left"><code>FLOAT</code></td>
<td align="left"><code>double</code></td>
</tr>
<tr>
<td align="left"><code>DOUBLE</code></td>
<td align="left"><code>double</code></td>
</tr>
<tr>
<td align="left"><code>BINARY</code></td>
<td align="left"><code>byte[]</code></td>
</tr>
<tr>
<td align="left"><code>VARBINARY</code></td>
<td align="left"><code>byte[]</code></td>
</tr>
<tr>
<td align="left"><code>LONGVARBINARY</code></td>
<td align="left"><code>byte[]</code></td>
</tr>
<tr>
<td align="left"><code>DATE</code></td>
<td align="left"><code>java.sql.Date</code>继承了java.util.Date</td>
</tr>
<tr>
<td align="left"><code>TIME</code></td>
<td align="left"><code>java.sql.Time</code>继承了java.util.Date</td>
</tr>
<tr>
<td align="left"><code>TIMESTAMP</code></td>
<td align="left"><code>java.sql.Timestamp</code>继承了java.util.Date</td>
</tr>
</tbody></table>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//数据库中Date类型、Java中Date数据类型到前端显示时间问题 的处理</span><br><span class="hljs-keyword">import</span> java.text.*;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Datetransform</span> </span>&#123;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 将Date类日期转为字符串日期</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param </span>date、 <span class="hljs-doctag">@param </span>format、 <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	 <br>	<span class="hljs-comment">//String DateFormatStr = &quot;yyyy-MM-dd HH:mm:ss&quot;;//年-月-日 时:分:秒</span><br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">param</span>(<span class="hljs-params"><span class="hljs-built_in">Date</span> date, <span class="hljs-built_in">String</span> format</span>)</span> &#123;<br>		SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(format);<br>		<span class="hljs-built_in">String</span> strDate = sdf.format(date);<span class="hljs-comment">//SimpleDateFormat.format(Date)--&gt;String时间字符串</span><br>		<span class="hljs-keyword">return</span> strDate;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 将字符串日期转化未Date类日期</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param </span>strDate、 <span class="hljs-doctag">@param </span>format、 <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">Date</span> <span class="hljs-function"><span class="hljs-title">parse</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pStrDate, <span class="hljs-built_in">String</span> pformat</span>)</span> &#123;<br>		SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(pformat);<br>		<span class="hljs-built_in">Date</span> date = <span class="hljs-literal">null</span>;<br>		<span class="hljs-keyword">try</span> &#123;<br>			date = sdf.parse(pStrDate);<span class="hljs-comment">//SimpleDateFormat.parse(String)--&gt;Date类时间对象</span><br>		&#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;<br>			e.printStackTrace();<br>		&#125;<br>		<span class="hljs-keyword">return</span> date;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="9、MyBatis-SQL参数传递-…-、-…"><a href="#9、MyBatis-SQL参数传递-…-、-…" class="headerlink" title="9、MyBatis SQL参数传递#{…}、${…}"></a>9、MyBatis SQL参数传递#{…}、${…}</h3><p><code>#&#123;OGNL表达式&#125;</code> 和 <code>$&#123;OGNL表达式&#125;</code> 的区别</p>
<h4 id="9-1、-OGNL表达式"><a href="#9-1、-OGNL表达式" class="headerlink" title="9.1、#{OGNL表达式}"></a>9.1、#{OGNL表达式}</h4><p>MyBatis会把这个表达式使用   “ ?(占位符) ”   替换，作为<code>一个sql参数</code>使用</p>
<p>比如name的值为: </p>
<p>​        定义SQL: <code>select * from t_user where name = #&#123;name&#125;</code></p>
<p>​        最终SQL: <code>select * from t_user where name = ?</code></p>
<h4 id="9-2、-OGNL表达式"><a href="#9-2、-OGNL表达式" class="headerlink" title="9.2、${OGNL表达式}"></a>9.2、${OGNL表达式}</h4><p>MyBatis会把这个表达式的值  替换到sql中  ，作为<code>sql的组成部分</code></p>
<p>该方式主要用于程序拼接SQL</p>
<p>比如name的值为: ‘<code>1 or 1=1</code>‘</p>
<p>​        定义SQL: select * from t_user where name = ${id}</p>
<p>​        最终SQL: select * from t_user where name = <code>1 or 1=1</code> 出现sql注入</p>
<p>如果sql中使用${OGNL}，并且参数的类型是(Integer，String….)那么OGNL表达式可以写成任意东西;</p>
<h4 id="9-3、SQL注入"><a href="#9-3、SQL注入" class="headerlink" title="9.3、SQL注入"></a>9.3、SQL注入</h4><p>预防sql注入，使用 占位符(?PrepareStatement) 查询</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> username=? <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>=?<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>=<span class="hljs-string">&#x27;admin&#x27;</span><br></code></pre></td></tr></table></figure>
<p>字符串拼接，会导致出现sql注入</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>=<span class="hljs-string">&#x27;0000&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="9-4、-OGNL-表达式的应用场景"><a href="#9-4、-OGNL-表达式的应用场景" class="headerlink" title="9.4、${OGNL}表达式的应用场景"></a>9.4、${OGNL}表达式的应用场景</h4><p>不能用在登录场景，会出现sql注入；</p>
<p>用在 <code>order by的场景</code> 或 <code>复杂的参数传递</code>：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs maxima">Map&lt;String,Object&gt;  <br><span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;orderBy&quot;</span>,&#x27;name desc&#x27;);<br><span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;begin&quot;</span>,<span class="hljs-number">0</span>);<br><span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;end&quot;</span>,<span class="hljs-number">10</span>);<br><br><span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;minAge&quot;</span>,<span class="hljs-number">19</span>);<br><span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;maxAge&quot;</span>,<span class="hljs-number">90</span>);<br>List&lt;User&gt; users1=session.selectList(<span class="hljs-string">&quot;cn.kongwei_liao.mapper.UserMapper&quot;</span>+<span class="hljs-string">&quot;.selectRange&quot;</span>,<span class="hljs-built_in">map</span>);<br>List&lt;User&gt; users2=session.selectList(<span class="hljs-string">&quot;cn.kongwei_liao.mapper.UserMapper&quot;</span>+<span class="hljs-string">&quot;.findByOrderBy&quot;</span>,<span class="hljs-built_in">map</span>);<br></code></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;select id=<span class="hljs-string">&quot;findByOrderBy&quot;</span> parameterType=<span class="hljs-string">&quot;map&quot;</span> resultType=cn.kongwei_liao.domain.Use<span class="hljs-string">r&quot;&gt;</span><br><span class="hljs-string">	select * from t_user order by $&#123;orderBy&#125; limit $&#123;begin&#125;,$&#123;end&#125;</span><br><span class="hljs-string">&lt;/select&gt;</span><br><span class="hljs-string">&lt;select id=&quot;</span>selectRange<span class="hljs-string">&quot; parameterType=&quot;</span>map<span class="hljs-string">&quot; resultType=cn.kongwei_liao.domain.User&quot;</span>&gt;<br>	select * from t_user where age between <span class="hljs-comment">#&#123;minAge&#125; and #&#123;maxAge&#125;</span><br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>
<p>在jdbc的sql代码order by后面不能使用占位符?   只能进行字符串的拼接。</p>
<h3 id="10、关联查询映射（多对一）"><a href="#10、关联查询映射（多对一）" class="headerlink" title="10、关联查询映射（多对一）"></a>10、关联查询映射（多对一）</h3><p>在有多个员工对应有同一个部门的情况，根据用户id查询该用户信息及其所在的部门名称。</p>
<h4 id="10-1、创建案例数据库"><a href="#10-1、创建案例数据库" class="headerlink" title="10.1、创建案例数据库"></a>10.1、创建案例数据库</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> TABLE <span class="hljs-symbol">`t_dept`</span> (<br><br>	<span class="hljs-symbol">`id`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,<br>	<span class="hljs-symbol">`name`</span> varchar(<span class="hljs-number">255</span>) DEFAULT <span class="hljs-literal">NULL</span>,<br> <br>	<span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol">`id`</span>)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br></code></pre></td></tr></table></figure>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> TABLE <span class="hljs-symbol">`t_user`</span> (<br><br>	<span class="hljs-symbol">`id`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,<br> 	<span class="hljs-symbol">`name`</span> varchar(<span class="hljs-number">255</span>) DEFAULT <span class="hljs-literal">NULL</span>,<br> 	<span class="hljs-symbol">`password`</span> varchar(<span class="hljs-number">255</span>) DEFAULT <span class="hljs-literal">NULL</span>,<br> 	<span class="hljs-symbol">`dept_id`</span> bigint(<span class="hljs-number">20</span>) DEFAULT <span class="hljs-literal">NULL</span>,<br> <br> 	<span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol">`id`</span>),<br> 	<span class="hljs-keyword">KEY</span> <span class="hljs-symbol">`fk1`</span> (<span class="hljs-symbol">`dept_id`</span>),<br> 	CONSTRAINT <span class="hljs-symbol">`fk1`</span> FOREIGN <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol">`dept_id`</span>) REFERENCES <span class="hljs-symbol">`t_dept`</span> (<span class="hljs-symbol">`id`</span>)<br> 	<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br></code></pre></td></tr></table></figure>
<p>[^CONSTRAINT]: CONSTRAINT [kənˈstreɪnt]  n. 限制; 限定; 约束; 严管;</p>
<h4 id="10-2、建立模型层：Dept、User等的JavaBean"><a href="#10-2、建立模型层：Dept、User等的JavaBean" class="headerlink" title="10.2、建立模型层：Dept、User等的JavaBean"></a>10.2、建立模型层：Dept、User等的JavaBean</h4><h4 id="10-3、配置文件MyBatis-Config-xml"><a href="#10-3、配置文件MyBatis-Config-xml" class="headerlink" title="10.3、配置文件MyBatis-Config.xml"></a>10.3、配置文件MyBatis-Config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 单向多对一 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;cn/kongwei_liao/mapper/DomainMapper.xml&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="10-4、映射文件DomainMapper-xml"><a href="#10-4、映射文件DomainMapper-xml" class="headerlink" title="10.4、映射文件DomainMapper.xml"></a>10.4、映射文件DomainMapper.xml</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.DomainMapper&quot;</span>&gt;</span></span><br><br><span class="xml">	<span class="hljs-comment">&lt;!-- 保存部门 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveDept&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.Dept&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="xml">		keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">		insert into t_dept(name) values(#</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="xml">)</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 保存用户 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.User&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="xml">		keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">		insert into t_user(name,password,dept_id) values(#</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;password&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;dept.id&#125;</span><span class="xml">)</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<h4 id="10-5、保存测试数据"><a href="#10-5、保存测试数据" class="headerlink" title="10.5、保存测试数据"></a>10.5、保存测试数据</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">String NAME_SPACE = &quot;cn.kongwei_liao.mapper.DomainMapper&quot;;<br><br>@Test<br><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> testSave() &#123;<br>	SqlSession <span class="hljs-keyword">session</span> = MyBatisUtils.getSession();<br>	// 先保存部门<br>	Dept dept1 = <span class="hljs-built_in">new</span> Dept();<br>	dept1.setName(&quot;部门1&quot;);//未设主键，插入记录主键自增<br>	Dept dept2 = <span class="hljs-built_in">new</span> Dept();<br>	dept2.setName(&quot;部门2&quot;);<br>	<span class="hljs-keyword">session</span>.<span class="hljs-keyword">insert</span>(NAME_SPACE + &quot;.saveDept&quot;, dept1);<br>	<span class="hljs-keyword">session</span>.<span class="hljs-keyword">insert</span>(NAME_SPACE + &quot;.saveDept&quot;, dept2);<br><br>	// 在保存用户<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>		<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span> = <span class="hljs-built_in">new</span> <span class="hljs-keyword">User</span>();<br>		<span class="hljs-keyword">user</span>.setName(&quot;user&quot; + i);<br>		<span class="hljs-keyword">user</span>.setPassword(&quot;admin&quot;);<br>		<span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-keyword">user</span>.setDept(dept1); // <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user(dept_id) <span class="hljs-keyword">values</span>(#&#123;dept.id&#125;)<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">user</span>.setDept(dept2);<br>		&#125;<br>		<span class="hljs-keyword">session</span>.<span class="hljs-keyword">insert</span>(NAME_SPACE + &quot;.saveUser&quot;, <span class="hljs-keyword">user</span>);<br>	&#125;<br><br>	<span class="hljs-keyword">session</span>.<span class="hljs-keyword">commit</span>();<br>	<span class="hljs-keyword">session</span>.<span class="hljs-keyword">close</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="10-6、多个表关联查询"><a href="#10-6、多个表关联查询" class="headerlink" title="10.6、多个表关联查询"></a>10.6、多个表关联查询</h4><h5 id="10-6-1、单表查询，不能查询部门的名称"><a href="#10-6-1、单表查询，不能查询部门的名称" class="headerlink" title="10.6.1、单表查询，不能查询部门的名称"></a>10.6.1、单表查询，不能查询部门的名称</h5><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.DomainMapper&quot;</span>&gt;</span></span><br><br><span class="xml">	<span class="hljs-comment">&lt;!-- 保存部门 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveDept&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.Dept&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="xml">		keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">		insert into t_dept(name) values(#</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="xml">)</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 保存用户 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.User&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="xml">		keyProperty=&quot;id&quot;&gt;</span><br><span class="xml">		insert into t_user(name,password,dept_id) values(#</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;password&#125;</span><span class="xml">,#</span><span class="hljs-template-variable">&#123;dept.id&#125;</span><span class="xml">)</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 查询用户 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resuleType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.User&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span></span><br><span class="xml">		select * from t_user</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<h5 id="10-6-2、等值连接查询"><a href="#10-6-2、等值连接查询" class="headerlink" title="10.6.2、等值连接查询"></a>10.6.2、等值连接查询</h5><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">select u.*,d.*<br><span class="hljs-keyword">from</span> t_user u,t_dept d<br><span class="hljs-keyword">where</span> u.dept_id=d.<span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure>
<h5 id="10-6-3、内连接查询"><a href="#10-6-3、内连接查询" class="headerlink" title="10.6.3、内连接查询"></a>10.6.3、内连接查询</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">select</span> u.*,d.*<br><span class="hljs-keyword">from</span> t_user u <br><span class="hljs-keyword">join</span> t_dept d<br><span class="hljs-keyword">on</span> u.dept_id=d.id<br></code></pre></td></tr></table></figure>
<h5 id="10-6-4、左外连接查询"><a href="#10-6-4、左外连接查询" class="headerlink" title="10.6.4、左外连接查询"></a>10.6.4、左外连接查询</h5><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> u.*,d.*<br><span class="hljs-keyword">from</span> t_user u <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> t_dept d<br><span class="hljs-keyword">on</span> u.dept_id=d.id<br></code></pre></td></tr></table></figure>
<h5 id="10-6-5、测试用例"><a href="#10-6-5、测试用例" class="headerlink" title="10.6.5、测试用例"></a>10.6.5、测试用例</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@Test<br><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> testGetAll() &#123;<br>	SqlSession <span class="hljs-keyword">session</span> = MyBatisUtils.getSession();<br>	List&lt;<span class="hljs-keyword">User</span>&gt; list = <span class="hljs-keyword">session</span>.selectList(NAME_SPACE + &quot;.getAll&quot;);//NAME_SPACE + &quot;.？&quot;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span> : list) &#123;<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">user</span>);<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">user</span>.getDept());<br>	&#125;<br>	<span class="hljs-keyword">session</span>.<span class="hljs-keyword">close</span>();<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="10-7、MyBatis提供两种方式处理associate关联对象"><a href="#10-7、MyBatis提供两种方式处理associate关联对象" class="headerlink" title="10.7、MyBatis提供两种方式处理associate关联对象"></a>10.7、MyBatis提供两种方式处理associate关联对象</h4><h5 id="10-7-1、嵌套结果"><a href="#10-7-1、嵌套结果" class="headerlink" title="10.7.1、嵌套结果"></a>10.7.1、嵌套结果</h5><p>发一条左外连接sql解决问题，映射文件Mapper结果的手动封装ResultMap</p>
<p>使用嵌套结果映射来处理重复的联合结果的子集。这种方式，所有属性映射都要自己来，没办法通过代码生成器生成！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.DomainMapper&quot;</span>&gt;</span><br>	<span class="hljs-comment">&lt;!-- User:Dept  多对一关系 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userResultMap&quot;</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- User表主键id 与 User实体类id属性 对应 --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span><br>	<br>		<span class="hljs-comment">&lt;!-- User表其他字段 与 User实体类其它属性 对应 --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span><br>		<br>		<span class="hljs-comment">&lt;!-- 此处associate标签的property属性值应是在User实体类内定义的属性，属性名dept，该属性类型是cn.kongwei_liai.Dept --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.Dept&quot;</span>&gt;</span><br>			<span class="hljs-comment">&lt;!-- Dept表主键id 与 Dept实体类id属性 对应 --&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;did&quot;</span> /&gt;</span><br>		<br>			<span class="hljs-comment">&lt;!-- Dept表其它字段 与 Dept实体类其它属性 对应 --&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dname&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 嵌套结果（发一条左外连接sql解决问题，映射文件Mapper结果的手动封装ResultMap） --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;userResultMap&quot;</span>&gt;</span><br>		select u.id,u.name,u.password,d.id did,d.name dname<br>		from t_user u<br>		left join t_dept d<br>		on u.dept_id=d.id<br>	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h5 id="10-7-2、嵌套查询"><a href="#10-7-2、嵌套查询" class="headerlink" title="10.7.2、嵌套查询"></a>10.7.2、嵌套查询</h5><p>发  一条查询user  和  n条查询dept   解决问题，映射文件Mapper结果的自动封装userResultMap</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.DomainMapper&quot;</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span> &gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span></span><br><span class="xml">   </span><br><span class="xml">		<span class="hljs-comment">&lt;!-- 此处associate标签的</span></span><br><span class="xml">   			property属性值：此处应是User实体类的属性，属性名dept； </span><br><span class="xml">   			column属性值：传给嵌套查询，做查询条件。</span><br><span class="xml">   		--&gt;</span><br><span class="xml">   		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.DomainMapper.findDeptBydeptId&quot;</span> /&gt;</span><span class="hljs-comment">&lt;!-- 嵌套了column=&quot;dept_id&quot; --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></span><br><br><span class="xml">	<span class="hljs-comment">&lt;!-- 根据返回来的n条user记录中的dept_id字段，查询dept --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findDeptBydeptId&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Dept&quot;</span>&gt;</span></span><br><span class="xml">	   select id,name from t_dept where id=#</span><span class="hljs-template-variable">&#123;dept_id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><br><span class="xml">	<span class="hljs-comment">&lt;!-- 一条查询user表，返回n条user记录 --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="xml">	   select u.id,u.username,u.password,u.dept_id</span><br><span class="xml">	   from t_user u</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="11、集合查询映射（一对多，多对多）"><a href="#11、集合查询映射（一对多，多对多）" class="headerlink" title="11、集合查询映射（一对多，多对多）"></a>11、集合查询映射（一对多，多对多）</h3><h4 id="11-1、常见关系"><a href="#11-1、常见关系" class="headerlink" title="11.1、常见关系"></a>11.1、常见关系</h4><p>员工和部门：一对多，根据部门查询员工</p>
<ul>
<li><p>在部门方，需要查询到当前部门下的所有员工。</p>
</li>
<li><p>一个部门  拥有  多个员工</p>
</li>
</ul>
<p>学生和课程：多对多，根据学生查询其选修课程，或根据课程查询查询选修该课程的学生</p>
<ul>
<li><p>一个学生  可以学习  多门课程</p>
</li>
<li><p>一门课程  可以有   多个学生</p>
</li>
</ul>
<h4 id="11-2、collection"><a href="#11-2、collection" class="headerlink" title="11.2、collection"></a>11.2、collection</h4><p>返回结果 （返回结果对象有一个属性List或Set&lt;关联表对象&gt;）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;集合数据属性名&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;集合中元素类型&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!-- 	extends: 集成已有resultMap；--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Department&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;DepartmentAndUsersResultMap&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;DepartmentResultMap&quot;</span>&gt;</span></span><br><span class="xml">	<span class="hljs-comment">&lt;!--</span></span><br><span class="xml">		关联集合：</span><br><span class="xml">			property：集合数据</span><br><span class="xml">			ofType：集合元素类型****</span><br><span class="xml">			select：通过这条SQL查询对应关联集合</span><br><span class="xml">				select * from t_user where dept_id = #</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">			column：关联对象表t_dept中的主键id  对应  当前对象表中t_user外键dept_id</span><br><span class="xml">	--&gt;</span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;users&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.DomainMapper.getByUserDept_Id&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<h4 id="11-3、嵌套结果（使用一条SQL语句）"><a href="#11-3、嵌套结果（使用一条SQL语句）" class="headerlink" title="11.3、嵌套结果（使用一条SQL语句）"></a>11.3、嵌套结果（使用一条SQL语句）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.DomainMapper&quot;</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Dept&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;DepartmentResultMap&quot;</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- 处理一方：部门 --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span><br>		<br>		<span class="hljs-comment">&lt;!-- 处理多方：员工 --&gt;</span><br>		<span class="hljs-comment">&lt;!-- // 单向一对多，结果保存再Set或List中 --&gt;</span><br>		<span class="hljs-comment">&lt;!-- private Set&lt;User&gt; users; --&gt;</span><br>		<span class="hljs-comment">&lt;!-- private List&lt;User&gt; users; --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;users&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept_id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_id&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br>	<br>	<span class="hljs-comment">&lt;!-- 嵌套结果（发一条左外连接sql解决问题，映射文件Mapper结果的手动封装ResultMap） --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;DepartmentResultMap&quot;</span>&gt;</span><br>		select d.id,d.name,u.id uid,u.name uname,u.password<br>		from t_dept d<br>		left join t_user u<br>		on d.id=u.dept_id<br>	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="11-4、嵌套查询"><a href="#11-4、嵌套查询" class="headerlink" title="11.4、嵌套查询"></a>11.4、嵌套查询</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.DomainMapper&quot;</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Dept&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;DepartmentResultMap&quot;</span>&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!-- 处理一方：部门 --&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span></span><br><span class="xml">		</span><br><span class="xml">		<span class="hljs-comment">&lt;!-- 处理多方：员工 --&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!-- // 单向一对多，结果保存再Set或List中 --&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!-- private Set&lt;User&gt; users; --&gt;</span></span><br><span class="xml">		<span class="hljs-comment">&lt;!-- private List&lt;User&gt; users; --&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;users&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.DomainMapper.getByUserDept_Id&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getByUserDept_Id&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span> &gt;</span></span><br><span class="xml">		select * from t_user where dept_id=$</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml">	</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- 嵌套结果（发一条左外连接sql解决问题，映射文件Mapper结果的手动封装ResultMap） --&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;DepartmentResultMap&quot;</span>&gt;</span></span><br><span class="xml">		select id,name</span><br><span class="xml">		from t_dept</span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<h3 id="12、嵌套结果和嵌套查询的使用场景"><a href="#12、嵌套结果和嵌套查询的使用场景" class="headerlink" title="12、嵌套结果和嵌套查询的使用场景"></a>12、嵌套结果和嵌套查询的使用场景</h3><h4 id="12-1、嵌套结果：一条SQL语句"><a href="#12-1、嵌套结果：一条SQL语句" class="headerlink" title="12.1、嵌套结果：一条SQL语句"></a>12.1、嵌套结果：一条SQL语句</h4><ol>
<li><p>用在多对一的表结构；</p>
</li>
<li><p>多个数据字典明细和一个数据字典类型；</p>
</li>
<li><p>多个员工属于一个部门；</p>
</li>
<li><p>多个部门有一个部门经理。</p>
</li>
</ol>
<h4 id="12-2、嵌套查询：1-n条SQL语句"><a href="#12-2、嵌套查询：1-n条SQL语句" class="headerlink" title="12.2、嵌套查询：1+n条SQL语句"></a>12.2、嵌套查询：1+n条SQL语句</h4><ol>
<li><p>用在 一对多 或者 多对多 的表结构；</p>
</li>
<li><p>展示数据的时候，在一行第一列显示一方，第二列显示多个多方；</p>
</li>
<li><p>一对多：（部门1  ：员工1。。。员工n）；</p>
</li>
<li><p>多对多：（员工1  ：角色1。。。角色n）。</p>
</li>
</ol>
<h3 id="13、SQL映射器Mapper"><a href="#13、SQL映射器Mapper" class="headerlink" title="13、SQL映射器Mapper"></a>13、SQL映射器Mapper</h3><p>MyBatis框架  <code>基于代理机制</code>，可以让我们<code>无需再编写Dao的实现</code>。</p>
<h4 id="13-1、传统Dao层接口，现在名称统一以Mapper结尾"><a href="#13-1、传统Dao层接口，现在名称统一以Mapper结尾" class="headerlink" title="13.1、传统Dao层接口，现在名称统一以Mapper结尾"></a>13.1、传统Dao层接口，现在名称统一以Mapper结尾</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">	定义MaBatis映射器（映射器其实就是操作数据库的对象，等效于之前的Dao层接口</span><br><span class="hljs-comment">	</span><br><span class="hljs-comment">	映射器配置于xml配置对应：</span><br><span class="hljs-comment">		接口中的方法名于SQL的id对应；</span><br><span class="hljs-comment">		接口中的方法返回值于SQL中的resultType/resultMap对应；</span><br><span class="hljs-comment">		接口中的方法参数类型于SQL中的parameterType对应。</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-built_in">public</span> interface UserMapper&#123;<br>	<span class="hljs-keyword">User</span> <span class="hljs-keyword">get</span>(Long id);<br>	List&lt;<span class="hljs-keyword">User</span>&gt; <span class="hljs-keyword">select</span>(Map&lt;String,<span class="hljs-keyword">Object</span>&gt; paramMap);<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="13-2、接口实现方式一（传统）"><a href="#13-2、接口实现方式一（传统）" class="headerlink" title="13.2、接口实现方式一（传统）"></a>13.2、接口实现方式一（传统）</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMapperImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserMapper</span></span>&#123;<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-function">User <span class="hljs-title">get</span><span class="hljs-params">(Long id)</span></span>&#123;<br>		SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>		<span class="hljs-keyword">try</span>&#123;<br>			sqlSession = MyBatisUtils.getSqlSession();<br>			<span class="hljs-function"><span class="hljs-keyword">return</span> sqlSession.<span class="hljs-title">selectone</span><span class="hljs-params">(<span class="hljs-string">&quot;cn.kongwei_liao.mapper.UserMapper.get&quot;</span>,id)</span></span>;<br>		&#125;<span class="hljs-keyword">finally</span>&#123;<br>			<span class="hljs-keyword">if</span>(sqlSession!=<span class="hljs-keyword">null</span>)&#123;<br>				sqlSession.close();<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="13-3、接口实现方式二（映射器）"><a href="#13-3、接口实现方式二（映射器）" class="headerlink" title="13.3、接口实现方式二（映射器）"></a>13.3、接口实现方式二（映射器）</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/*</span><br><span class="hljs-comment">	定义一个映射器Mapper接口，使用MyBatis自动为我们创建的代理类；</span><br><span class="hljs-comment">*/</span><br>public <span class="hljs-keyword">class</span> MyBatisMapperTest&#123;<br>	@Test<br>	public void test<span class="hljs-constructor">Proxy()</span> throws Exception&#123;<br>		<span class="hljs-comment">//getMapper(Mapper接口)，通过MyBatis为我们创建指定Mapper接口代理对象；</span><br>		UserMapper mapper = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MyBatisUtils</span>.</span></span>get<span class="hljs-constructor">SqlSession()</span>.get<span class="hljs-constructor">Mapper(UserMapper.<span class="hljs-params">class</span>)</span>;<br>		<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(mapper.get(<span class="hljs-number">1L</span>));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="14、缓存"><a href="#14、缓存" class="headerlink" title="14、缓存"></a>14、缓存</h3><p>默认支持一级缓存，二级缓存需要配置，同JPA一致</p>
<p>缓存是一种典型的  “以空间换时间”  的策略。</p>
<h4 id="14-1、一级缓存"><a href="#14-1、一级缓存" class="headerlink" title="14.1、一级缓存"></a>14.1、一级缓存</h4><p>SqlSession级别缓存，缓存对象存储周期为第一次获取，到sqlsession被销毁掉，或是sqlSession().clearCache()；</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@Test<br><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> testProxy()&#123;<br>    SqlSession <span class="hljs-keyword">session</span> = MyBatisUtils.getSession();<br>    UserMapper mapper = <span class="hljs-keyword">session</span>.getMapper(UserMapper.<span class="hljs-keyword">class</span>);<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(mapper.<span class="hljs-keyword">get</span>(<span class="hljs-number">8</span>L));//发送一条<span class="hljs-keyword">sql</span><br>    <span class="hljs-keyword">session</span>.clearCache();<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(mapper.<span class="hljs-keyword">get</span>(<span class="hljs-number">8</span>L));//清除缓存之后 在发送一条<span class="hljs-keyword">sql</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="14-2、二级缓存"><a href="#14-2、二级缓存" class="headerlink" title="14.2、二级缓存"></a>14.2、二级缓存</h4><p>SqlSessionFactory级别缓存，缓存对象存储周期为第一次获取，到SqlSessionFactory被销毁掉(应用停止了)；</p>
<p>默认情况下，只开启一级缓存，如果需要开启二级缓存我们需要在Mapper.xml添加一个&lt;cache&gt;标签。</p>
<ol>
<li>注意：需要缓存的对象，应该实现java.io.Serializable；</li>
</ol>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">&lt;mapper <span class="hljs-keyword">namespace</span>=<span class="hljs-string">&quot;cn.kongwei_liao.mapper.UserMapper&quot;</span>&gt;<br>   &lt;cache/&gt;<br>…<br>&lt;/mapper&gt;<br>同时类要进行序列化<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span><br></code></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Test<br>public void test<span class="hljs-constructor">SecondLevel()</span>&#123;<br><br>	SqlSession session1 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MyBatisUtils</span>.</span></span>get<span class="hljs-constructor">Session()</span>;<br>	UserMapper mapper1 = session1.get<span class="hljs-constructor">Mapper(UserMapper.<span class="hljs-params">class</span>)</span>;<br>	<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(mapper1.get(<span class="hljs-number">8L</span>));<span class="hljs-comment">//发送一条sql</span><br>	session1.close<span class="hljs-literal">()</span>;<br>	<br>	SqlSession session2 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MyBatisUtils</span>.</span></span>get<span class="hljs-constructor">Session()</span>;<br>	UserMapper mapper2 = session2.get<span class="hljs-constructor">Mapper(UserMapper.<span class="hljs-params">class</span>)</span>;<br>	<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(mapper2.get(<span class="hljs-number">8L</span>));<br>	session2.close<span class="hljs-literal">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/02/15/Object/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/02/15/MyBatis-%E9%AB%98%E7%BA%A7/">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
