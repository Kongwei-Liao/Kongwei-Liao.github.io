

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="liaogangwei的个人主页">
  <meta name="author" content="Kongwei_Liao">
  <meta name="keywords" content="black, foolish, positive">
  <title>Kongwei_Liao</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-15 19:45" pubdate>
        2021年2月15日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      111
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none"></h1>
            
            <div class="markdown-body">
              <h3 id="Shiro安全框架"><a href="#Shiro安全框架" class="headerlink" title="Shiro安全框架"></a>Shiro安全框架</h3><p>Apache Shiro是一个<code>强大且易用的Java安全框架</code>，有<code>身份验证</code>、<code>授权</code>、<code>密码学</code>和<code>会话管理</code>。使用Shiro的易于理解的API，您可以快速、轻松地获得任何应用程序，从最小的移动应用程序到最大的网络和企业应用程序。</p>
<ul>
<li><p>Spring security是一个重量级的安全框架</p>
</li>
<li><p>Apache Shiro是一个轻量级的安全框架</p>
</li>
</ul>
<p><img src="Shiro/image-20191214181115794.png" srcset="/img/loading.gif" alt="image-20191214181115794"></p>
<p>Shiro 开发团队称 “ 应用程序的四大基石：身份验证，授权，会话管理和加密 “ 为其目标。</p>
<p><strong>Authentication(身份认证)：</strong></p>
<p>有时也简称为“登录”，这是一个证明用户是他们所说的他们是谁的行为。</p>
<p><strong>Authorization（授权）：</strong></p>
<p>访问控制的过程，也就是绝对“谁”去访问“什么”权限。</p>
<p><strong>Session Management（会话管理）：</strong></p>
<p>管理用户特定的会话，即使在非 Web 或 EJB 应用程序。</p>
<p><strong>Cryptography（密码学）：</strong></p>
<p>通过使用加密算法保持数据安全同时易于使用。</p>
<p>Shiro还提供了额外的功能来支持和加强在不同环境下所关注的方面，尤其是以下这些：</p>
<p><strong>Web Support：</strong> Shiro 的 web 支持的 API 能够轻松地帮助保护 Web 应用程序。</p>
<p><strong>Caching：</strong>缓存是 Apache Shiro 中的第一层公民，来确保安全操作快速而又高效。</p>
<p><strong>Concurrency：</strong> Apache Shiro 利用它的并发特性来支持多线程应用程序。</p>
<p><strong>Testing：</strong>测试支持的存在来帮助你编写单元测试和集成测试，并确保你的能够如预期的一样安全。</p>
<p><strong>“Run As”：</strong>一个允许用户假设为另一个用户身份（如果允许）的功能，有时候在管理脚本很有用。</p>
<p><strong>“Remember Me”：</strong>在会话中记住用户的身份，所以他们只需要在强制时候登录。</p>
<h4 id="1、Shiro的架构"><a href="#1、Shiro的架构" class="headerlink" title="1、Shiro的架构"></a>1、Shiro的架构</h4><h5 id="1、Shiro外部来说"><a href="#1、Shiro外部来说" class="headerlink" title="1、Shiro外部来说"></a>1、Shiro外部来说</h5><p>从外部来看Shiro，即从应用程序角度来如何使用shiro来完成工作(认证、授权等)。</p>
<p><img src="Shiro/image-20191214182355268.png" srcset="/img/loading.gif" alt="image-20191214182355268"></p>
<p><strong>Subject：</strong>应用代码直接交互的对象是Subject，也就是说Shiro的对外API核心就是Subject。Subject代表了当前“用户”，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是Subject，如网络爬虫、机器人等；</p>
<p>与Subject的所有交互都会委托给SecurityManager，Subject其实就是一个门面，SecurityManager才是实际的执行者；</p>
<p><strong>SecurityManager：</strong>安全管理器，即所有与安全有关的操作都会SecurityManager交互，并且管理着所有Subject；可以看出他是Shiro的核心，它负责与Shiro的其他组件进行交互，它相当于SpringMVC中DispatcherServlet的角色；</p>
<p><strong>Realm：</strong>Shiro从Realm获取安全数据（如用户，角色，权限），就是说SecurityManager要验证用户身份，那么他需要从Realm获取相应的用户进行比较以确定用户身份是否合法；也需要Realm得到用户相应的角色/权限进行验证用户是否能进行；可以把Realm看成DataSource。</p>
<h5 id="2、Shiro内部来看"><a href="#2、Shiro内部来看" class="headerlink" title="2、Shiro内部来看"></a>2、Shiro内部来看</h5><p><img src="Shiro/image-20191214183943765.png" srcset="/img/loading.gif" alt="image-20191214183943765"></p>
<p><strong>Subject：</strong>倒可可以与应用交互的”用户”；</p>
<p><strong>SecurityManager：</strong>相当于SpringMVC中的DispatcherServIet；是Shiro的心脏，所有具体的交互都通过SecurityManager进行控制；它管理着所有Subject、且负责进行认证、授权、会话及缓存的管理；</p>
<p><strong>Authenticator：</strong>负责Subject认证，是一个扩展点，可以自定义实现；可以使用认证策略（AuthenticationStrategy），即什么情况下算用户认证通过了；</p>
<p><strong>Authorizer：</strong>授权器、即访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能 ；</p>
<p><strong>Realm：</strong>可以有1个或多个Realm，可以认为是安全实体数据源，即用于获取安全实体的，可以是JDBC实现也可以是内存实现等等；由用户提供，所以一般在应用中都需要实现自己的Realm；</p>
<p><strong>SessionManager：</strong>管理Session生命周期的组件，而Shiro并不仅仅可以用在Web环境，也可以用在如普通的JavaSE环境；</p>
<p><strong>CacheManager：</strong>缓存控制器，来管理如用户、角色、权限等的缓存的，因为这些数据基本上很少改变，放到缓存中后可以提高访问的性能；</p>
<p><strong>Cryptography：</strong>密码模块Shiro提高了一些常见的加密组件用于如密码加密/解密。</p>
<p>小结：</p>
<p>Shiro：是一个apache的安全框架，还有spring security；</p>
<p>Shiro：能做：身份认证(登录)authentication，授权authorization，密码学，会话管理。</p>
<p>Shiro路线：应用 –&gt; Subject(当前用户) –&gt; Security Mananger管理 –&gt; Realm –&gt; db</p>
<h4 id="2、Shiro入门"><a href="#2、Shiro入门" class="headerlink" title="2、Shiro入门"></a>2、Shiro入门</h4><h5 id="2-1、导如相关依赖包"><a href="#2-1、导如相关依赖包" class="headerlink" title="2.1、导如相关依赖包"></a>2.1、导如相关依赖包</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- shiro的支持包 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-comment">&lt;!-- shiro-core --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h5 id="2-2、准备资源"><a href="#2-2、准备资源" class="headerlink" title="2.2、准备资源"></a>2.2、准备资源</h5><p>这个资源我们可以到shiro的源码文件中拷备：/shiro-root-1.4.0-RC2/samples/quickstart/src/main/resources</p>
<ul>
<li><strong>shiro.ini</strong></li>
<li><strong>log4j.properties</strong></li>
</ul>
<p>注：users下面代表的登录的用户(用户名=密码)</p>
<p><strong>shiro.ini</strong>文件(对拷备过来的数据进行了解释)：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Users and their assigned roles</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Each line conforms to the format defined in the</span><br><span class="hljs-comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setUserDefinitions JavaDoc</span><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-section">[users]</span><br><span class="hljs-comment"># user &#x27;root&#x27; with password &#x27;secret&#x27; and the &#x27;admin&#x27; role</span><br><span class="hljs-attr">root</span> = secret, admin<br><span class="hljs-comment"># user &#x27;guest&#x27; with the password &#x27;guest&#x27; and the &#x27;guest&#x27; role</span><br><span class="hljs-attr">guest</span> = guest, guest<br><span class="hljs-comment"># user &#x27;presidentskroob&#x27; with password &#x27;12345&#x27; (&quot;That&#x27;s the same combination on</span><br><span class="hljs-comment"># my luggage!!!&quot; ;)), and role &#x27;president&#x27;</span><br><span class="hljs-attr">presidentskroob</span> = <span class="hljs-number">12345</span>, president<br><span class="hljs-comment"># user &#x27;darkhelmet&#x27; with password &#x27;ludicrousspeed&#x27; and roles &#x27;darklord&#x27; and &#x27;schwartz&#x27;</span><br><span class="hljs-attr">darkhelmet</span> = ludicrousspeed, darklord, schwartz<br><span class="hljs-comment"># user &#x27;lonestarr&#x27; with password &#x27;vespa&#x27; and roles &#x27;goodguy&#x27; and &#x27;schwartz&#x27;</span><br><span class="hljs-attr">lonestarr</span> = vespa, goodguy, schwartz<br><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Roles with assigned permissions</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># Each line conforms to the format defined in the</span><br><span class="hljs-comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc</span><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-section">[roles]</span><br><span class="hljs-comment"># &#x27;admin&#x27; role has all permissions, indicated by the wildcard &#x27;*&#x27;</span><br><span class="hljs-attr">admin</span> = *<br><span class="hljs-comment"># The &#x27;schwartz&#x27; role can do anything (*) with any lightsaber:</span><br><span class="hljs-attr">schwartz</span> = lightsaber:*<br><span class="hljs-comment"># The &#x27;goodguy&#x27; role is allowed to &#x27;drive&#x27; (action) the winnebago (type) with</span><br><span class="hljs-comment"># license plate &#x27;eagle5&#x27; (instance specific id)</span><br><span class="hljs-attr">goodguy</span> = winnebago:drive:eagle5<br></code></pre></td></tr></table></figure>
<h5 id="2-3、测试"><a href="#2-3、测试" class="headerlink" title="2.3、测试"></a>2.3、测试</h5><p>Session数据、登录、授权</p>
<p>这个文件位置 : /shiro-root-1.4.0-RC2/samples/quickstart/src/main/java</p>
<p>我们下面对这个文件进行了中文的解释</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 简单的入门示例，教我们怎么使用shiro中的一个API</span><br><span class="hljs-comment"> */</span><br>public <span class="hljs-keyword">class</span> Quickstart &#123;<br><br>    <span class="hljs-keyword">private</span> static final transient Logger log = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LoggerFactory</span>.</span></span>get<span class="hljs-constructor">Logger(Quickstart.<span class="hljs-params">class</span>)</span>;<br><br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        <span class="hljs-comment">//读取到shiro.ini文件，并且根据文件创建SecurityManager对象</span><br>        <span class="hljs-comment">//  SecurityManager：权限的核心管理对象</span><br>        Factory&lt;SecurityManager&gt; factory = <span class="hljs-keyword">new</span> <span class="hljs-constructor">IniSecurityManagerFactory(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>)</span>;<br>        SecurityManager securityManager = factory.get<span class="hljs-constructor">Instance()</span>;<br><br>        <span class="hljs-comment">// 为了程序正常运行，需要设计一个这个securityManager(相当于把这个管理放到环境中去了)</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>set<span class="hljs-constructor">SecurityManager(<span class="hljs-params">securityManager</span>)</span>;<br><br>        <span class="hljs-comment">//拿到当前用户【Subject:操作当前系统的一个用户】</span><br>        Subject currentUser = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>get<span class="hljs-constructor">Subject()</span>;<br><br>        <span class="hljs-comment">//拿到一个会话(它在咱们的所有类型系统都可以使用【不要求必需是web项目】)</span><br>        Session session = currentUser.get<span class="hljs-constructor">Session()</span>;<br>        <span class="hljs-comment">//会话操作【可以在会话中设置值与获取值】</span><br>        session.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;someKey&quot;</span>, <span class="hljs-string">&quot;aValue&quot;</span>)</span>;<br>        String value = (String) session.get<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;someKey&quot;</span>)</span>;<br>        <span class="hljs-keyword">if</span> (value.equals(<span class="hljs-string">&quot;aValue&quot;</span>)) &#123;<br>           <span class="hljs-comment">// log.info(&quot;Retrieved the correct value! [&quot; + value + &quot;]&quot;);</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;可以获取到这个值&quot;</span>+value);<br>        &#125;<br><br>        <span class="hljs-comment">//判断这个用户是否经过验证(没有登录我们可以认为是一个游客)</span><br>        <span class="hljs-comment">//没有登录，我们就可以完成登录</span><br>        <span class="hljs-keyword">if</span> (!currentUser.is<span class="hljs-constructor">Authenticated()</span>) &#123;<br>            <span class="hljs-comment">//拿到用户名与密码令牌【拿到用户名与密码】</span><br>            UsernamePasswordToken token = <span class="hljs-keyword">new</span> <span class="hljs-constructor">UsernamePasswordToken(<span class="hljs-string">&quot;lonestarr&quot;</span>, <span class="hljs-string">&quot;vespa&quot;</span>)</span>;<br>            <span class="hljs-comment">//设置记住我的功能</span><br>            token.set<span class="hljs-constructor">RememberMe(<span class="hljs-params">true</span>)</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//完成登录功能</span><br>                currentUser.login(token);<br>            &#125; catch (UnknownAccountException uae) &#123;<br>                <span class="hljs-comment">//log.info(&quot;There is no user with username of &quot; + token.getPrincipal());</span><br>                <span class="hljs-comment">//token.getPrincipal()[ˈprɪnsəpl] -&gt; 拿到主体（登录用户的主要标识【用户名】）</span><br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这没有这个账号（用户名）&quot;</span>+token.get<span class="hljs-constructor">Principal()</span>);<br>            &#125; catch (IncorrectCredentialsException ice) &#123;<br>                <span class="hljs-comment">//incorrect [ˌɪnkəˈrekt]:不正确的，错误的</span><br>                <span class="hljs-comment">//Credentials[krəˈdenʃlz]:证书; 凭证，证件</span><br>                <span class="hljs-comment">//log.info(&quot;Password for account &quot; + token.getPrincipal() + &quot; was incorrect!&quot;);</span><br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个密码是错误的&quot;</span>+token.get<span class="hljs-constructor">Principal()</span>);<br>            &#125; catch (LockedAccountException lae) &#123;<br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个账号已经被锁定&quot;</span>);<br>            &#125;<br>            <span class="hljs-comment">//其它的登录失败异常【它是所有登录异常的父类】</span><br>            catch (AuthenticationException ae) &#123;<br>                <span class="hljs-comment">//unexpected condition?  error?</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">//用户登录成功</span><br>        log.info(<span class="hljs-string">&quot;User [&quot;</span> + currentUser.get<span class="hljs-constructor">Principal()</span> + <span class="hljs-string">&quot;] logged in successfully.&quot;</span>);<br><br>        <span class="hljs-comment">//判断这个用户是否是某一个角色</span><br>        <span class="hljs-keyword">if</span> (currentUser.has<span class="hljs-constructor">Role(<span class="hljs-string">&quot;schwartz&quot;</span>)</span>) &#123;<br>            log.info(<span class="hljs-string">&quot;May the Schwartz be with you!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Hello, mere mortal.&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//测试用户是否有某一个权限</span><br>        <span class="hljs-keyword">if</span> (currentUser.is<span class="hljs-constructor">Permitted(<span class="hljs-string">&quot;lightsaber:wield&quot;</span>)</span>) &#123;<br>            log.info(<span class="hljs-string">&quot;You may use a lightsaber ring.  Use it wisely.&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Sorry, lightsaber rings are for schwartz masters only.&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//a (very powerful) Instance Level permission:</span><br>        <span class="hljs-keyword">if</span> (currentUser.is<span class="hljs-constructor">Permitted(<span class="hljs-string">&quot;winnebago:drive:eagle5&quot;</span>)</span>) &#123;<br>            log.info(<span class="hljs-string">&quot;You are permitted to &#x27;drive&#x27; the winnebago with license plate (id) &#x27;eagle5&#x27;.  &quot;</span> +<br>                    <span class="hljs-string">&quot;Here are the keys - have fun!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Sorry, you aren&#x27;t allowed to drive the &#x27;eagle5&#x27; winnebago!&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//登出(注销当前登录用户)</span><br>        currentUser.logout<span class="hljs-literal">()</span>;<br><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>exit(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="2-4、总结"><a href="#2-4、总结" class="headerlink" title="2.4、总结"></a>2.4、总结</h5><p>通过SecurityManger获取Suject :</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>set<span class="hljs-constructor">SecurityManager(<span class="hljs-params">securityManager</span>)</span>;<br>Subject currentUser = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>get<span class="hljs-constructor">Subject()</span>;<br></code></pre></td></tr></table></figure>
<p>通过Subject来做事情：</p>
<p>获取Session-存值和获取值 Subject.getSession、session.setAttribute、session.getAttribute</p>
<p>认证（登录）:</p>
<ul>
<li><p>判断是否登录Suject.isAuthenticated()</p>
</li>
<li><p>如果没有登录，通过用户名和密码创建UsernamePasswordToken</p>
</li>
<li><p>调用subject.login(UsernamePasswordToken)来进行登录判断</p>
</li>
<li><p>登陆成功: 返回principal给当前用户</p>
</li>
<li><p>登陆失败: 抛出异常</p>
</li>
</ul>
<p>授权：</p>
<ul>
<li><p>判断是否具有某个角色subject .hasRole</p>
</li>
<li><p>判断是否有权限subject .isPrermited(resource:操作)</p>
</li>
</ul>
<h4 id="3、自定义Realm"><a href="#3、自定义Realm" class="headerlink" title="3、自定义Realm"></a>3、自定义Realm</h4><p>刚才咱们使用的是准备的好的一个Realm，在Shiro中，除了咱们 刚才使用的IniRealm（通过Shiro.ini拿数据），还有普通SimpleAccountRealm，JDBCRealm等等。</p>
<p>但是这些Realm都不能满足咱们的需求 (后期咱们Realm的数据肯定是通过JPA去拿的，下一个项目要使用MyBatis去拿)，而这种情况下，就需要我们自己定义一个Realm来实现相应的功能！</p>
<h5 id="3-1、准备工作"><a href="#3-1、准备工作" class="headerlink" title="3.1、准备工作"></a>3.1、准备工作</h5><p>自定义Realm一般直接继承AuthorizingRealm接口即可(里面包含<code>身份认证</code>与<code>授权</code>两个方法)</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义一个Realm</span><br><span class="hljs-comment"> */</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br><br>    <span class="hljs-comment">//获取到这个Realm的名称(随便取)</span><br>    <span class="hljs-meta">@Override</span><br>    public <span class="hljs-type">String</span> getName() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MyRealm&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//进行授权判断（权限）</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">AuthorizationInfo</span> doGetAuthorizationInfo(<span class="hljs-type">PrincipalCollection</span> principalCollection) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//进行身份认证(登录)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">AuthenticationInfo</span> doGetAuthenticationInfo(<span class="hljs-type">AuthenticationToken</span> authenticationToken) <span class="hljs-keyword">throws</span> <span class="hljs-type">AuthenticationException</span> &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="3-2、身份认证（登录）"><a href="#3-2、身份认证（登录）" class="headerlink" title="3.2、身份认证（登录）"></a>3.2、身份认证（登录）</h5><p>身份认证的代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义一个Realm</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br><br>    <span class="hljs-comment">//获取到这个Realm的名称(随便取)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MyRealm&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//进行授权的认证</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-function"><span class="hljs-title">doGetAuthorizationInfo</span>(<span class="hljs-params">PrincipalCollection principalCollection</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//进行登录的认证</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException &#123;<br>        <span class="hljs-comment">//明显的知道：这个authenticationToken就是UsernamePasswordtoken</span><br>        UsernamePasswordToken token = (UsernamePasswordToken)authenticationToken;<br>        <span class="hljs-built_in">String</span> username = token.getUsername(); <span class="hljs-comment">//拿到用户名(注:这个用户名是传过来的)</span><br>        <span class="hljs-comment">//这里根据用户名去获取密码(如果没有获取到，相当于这个用户不存在，就返回null值)</span><br>        <span class="hljs-built_in">String</span> password = getByName(username);<br>        <span class="hljs-keyword">if</span>(password==<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">//创建一个简单的身份信息(把用户名与密码放进去-注：它会自动的比较获取的密码与你传过来的密码)</span><br>        SimpleAuthenticationInfo authenticationInfo = <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(username,password,getName());<br>        <span class="hljs-keyword">return</span> authenticationInfo;<br>    &#125;<br><br><span class="hljs-comment">//模拟从数据库中获取信息</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getByName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(username))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;guest&quot;</span>.equals(username))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;abcd&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>身份认证测试</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Test<br>public void test<span class="hljs-constructor">MyRealm()</span> throws Exception&#123;<br><br>    <span class="hljs-comment">//创建自己定义的Realm</span><br>    MyRealm myRealm = <span class="hljs-keyword">new</span> <span class="hljs-constructor">MyRealm()</span>;<br>   <span class="hljs-comment">//把Realm放到securityManager中去</span><br>    DefaultSecurityManager securityManager = <span class="hljs-keyword">new</span> <span class="hljs-constructor">DefaultSecurityManager()</span>;<br>    securityManager.set<span class="hljs-constructor">Realm(<span class="hljs-params">myRealm</span>)</span>;<br>    <span class="hljs-comment">//把权限管理器放到相应的环境中(我们可以在项目任何位置拿到)</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>set<span class="hljs-constructor">SecurityManager(<span class="hljs-params">securityManager</span>)</span>;<br><br>    <span class="hljs-comment">//拿到当前用户(Subject就是当前用户,游客)</span><br>    Subject currentUser = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>get<span class="hljs-constructor">Subject()</span>;<br>    <span class="hljs-comment">//准备登录的令牌(准备用户名与密码)</span><br>    UsernamePasswordToken token = <span class="hljs-keyword">new</span> <span class="hljs-constructor">UsernamePasswordToken(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>)</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//根据令牌进行功能登录(当前用户进行登录)</span><br>        currentUser.login(token);<br>    &#125; catch (UnknownAccountException e) &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个账号不存在!&quot;</span> + token.get<span class="hljs-constructor">Principal()</span>);<br>        e.print<span class="hljs-constructor">StackTrace()</span>;<br>    &#125; catch (IncorrectCredentialsException ice) &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个密码不存在!&quot;</span> + token.get<span class="hljs-constructor">Principal()</span>);<br>        ice.print<span class="hljs-constructor">StackTrace()</span>;<br>    &#125;catch (AuthenticationException e)&#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;i don&#x27;t k&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="3-3、授权（权限）认证"><a href="#3-3、授权（权限）认证" class="headerlink" title="3.3、授权（权限）认证"></a>3.3、授权（权限）认证</h5><p>授权认证的代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br><br>    <span class="hljs-comment">//获取到这个Realm的名称(随便取)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MyRealm&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//进行授权的认证</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-function"><span class="hljs-title">doGetAuthorizationInfo</span>(<span class="hljs-params">PrincipalCollection principalCollection</span>)</span> &#123;<br>    <br>        <span class="hljs-comment">//拿到认证的主要信息(用户名)</span><br>        <span class="hljs-built_in">String</span> username = (<span class="hljs-built_in">String</span>) principalCollection.getPrimaryPrincipal();<br>        <br>        <span class="hljs-comment">//模拟 根据用户名  拿到  角色信息与权限信息</span><br>        <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; roles = getRolesByUsername(username);<br>        <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; permissions = getPermissionsByUsername(username);<br>        <br>        <span class="hljs-comment">//拿到验证信息对象</span><br>        SimpleAuthorizationInfo authorizationInfo = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();<br>        <br>        <span class="hljs-comment">//设置用户的角色</span><br>        authorizationInfo.setRoles(roles);<br>        <br>        <span class="hljs-comment">//设置用户的权限</span><br>        authorizationInfo.setStringPermissions(permissions);<br>        <span class="hljs-keyword">return</span> authorizationInfo;<br>    &#125;<br><br>    <span class="hljs-comment">//模拟 根据用户名  拿到  角色的功能</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-function"><span class="hljs-title">getRolesByUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>)</span> &#123;<br>        <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; roles = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>        roles.add(<span class="hljs-string">&quot;admin&quot;</span>);<br>        roles.add(<span class="hljs-string">&quot;it&quot;</span>);<br>        <span class="hljs-keyword">return</span> roles;<br>    &#125;<br>    <span class="hljs-comment">//模拟 根据用户名  拿到  权限的功能</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-function"><span class="hljs-title">getPermissionsByUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>)</span> &#123;<br>        <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; permissions = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>        permissions.add(<span class="hljs-string">&quot;employee.*&quot;</span>);<br>        permissions.add(<span class="hljs-string">&quot;department.save&quot;</span>);<br>        <span class="hljs-keyword">return</span> permissions;<br>    &#125;<br> ...<br>&#125;<br></code></pre></td></tr></table></figure>
<p>功能测试</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;是否是这个角色：&quot;</span>+currentUser.has<span class="hljs-constructor">Role(<span class="hljs-string">&quot;admin&quot;</span>)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;是否是拥有权限：&quot;</span>+currentUser.is<span class="hljs-constructor">Permitted(<span class="hljs-string">&quot;employee.save&quot;</span>)</span>);<br></code></pre></td></tr></table></figure>


<h4 id="4、密码加密"><a href="#4、密码加密" class="headerlink" title="4、密码加密"></a>4、密码加密</h4><h5 id="4-1、Shiro中的密码加密"><a href="#4-1、Shiro中的密码加密" class="headerlink" title="4.1、Shiro中的密码加密"></a>4.1、Shiro中的密码加密</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  algorithmName:加密算法(md5,sha)</span><br><span class="hljs-comment"> *  source:原始密码</span><br><span class="hljs-comment"> *  salt,加盐</span><br><span class="hljs-comment"> *  hashIterations:遍历次数</span><br><span class="hljs-comment"> */</span><br>SimpleHash simpleHash = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleHash(<span class="hljs-string">&quot;MD5&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;kongwei_liao&quot;</span>,10)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(simpleHash);<br></code></pre></td></tr></table></figure>
<h5 id="4-2、测试时让自定义Realm加上算法"><a href="#4-2、测试时让自定义Realm加上算法" class="headerlink" title="4.2、测试时让自定义Realm加上算法"></a>4.2、测试时让自定义Realm加上算法</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Test<br>public void test<span class="hljs-constructor">MyRealm()</span> throws Exception&#123;<br><br>    <span class="hljs-comment">//创建自己定义的Realm</span><br>    MyRealm myRealm = <span class="hljs-keyword">new</span> <span class="hljs-constructor">MyRealm()</span>;<br>    <br>    <span class="hljs-comment">//把Realm放到securityManager中去</span><br>    DefaultSecurityManager securityManager = <span class="hljs-keyword">new</span> <span class="hljs-constructor">DefaultSecurityManager()</span>;<br>    securityManager.set<span class="hljs-constructor">Realm(<span class="hljs-params">myRealm</span>)</span>;<br>    <br>    <span class="hljs-comment">//把权限管理器放到相应的环境中(我们可以在项目任何位置拿到)</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>set<span class="hljs-constructor">SecurityManager(<span class="hljs-params">securityManager</span>)</span>;<br><br>	<span class="hljs-comment">//设置咱们Realm的密码匹配器(我们的密码要怎么处理)</span><br>    HashedCredentialsMatcher matcher = <span class="hljs-keyword">new</span> <span class="hljs-constructor">HashedCredentialsMatcher()</span>;<br>    matcher.set<span class="hljs-constructor">HashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>)</span>; <span class="hljs-comment">//匹配器使用MD5的算法</span><br>    matcher.set<span class="hljs-constructor">HashIterations(10)</span>;<span class="hljs-comment">//加密算法要迭代多少次</span><br>    myRealm.set<span class="hljs-constructor">CredentialsMatcher(<span class="hljs-params">matcher</span>)</span>;<br><br>	<span class="hljs-comment">//拿到当前用户(Subject就是当前用户,游客)</span><br>    Subject currentUser = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>get<span class="hljs-constructor">Subject()</span>;<br>    <span class="hljs-comment">//准备登录的令牌(准备用户名与密码) -&gt; 这里的密码进行了加密</span><br>    UsernamePasswordToken token = <span class="hljs-keyword">new</span> <span class="hljs-constructor">UsernamePasswordToken(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>)</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//根据令牌进行功能登录(当前用户进行登录)</span><br>        currentUser.login(token);<br>    	<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;登录成功啦。。。。&quot;</span>);<br>     &#125; catch (UnknownAccountException e) &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个账号不存在!&quot;</span> + token.get<span class="hljs-constructor">Principal()</span>);<br>        e.print<span class="hljs-constructor">StackTrace()</span>;<br>     &#125; catch (IncorrectCredentialsException ice) &#123;<br>         <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;这个密码不存在!&quot;</span> + token.get<span class="hljs-constructor">Principal()</span>);<br>         ice.print<span class="hljs-constructor">StackTrace()</span>;<br>     &#125;catch (AuthenticationException e)&#123;<br>         <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;i don&#x27;t k&quot;</span>);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="4-3、自定义Realm加上盐值"><a href="#4-3、自定义Realm加上盐值" class="headerlink" title="4.3、自定义Realm加上盐值"></a>4.3、自定义Realm加上盐值</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//进行登录的认证</span><br>@Override<br>protected AuthenticationInfo <span class="hljs-keyword">do</span><span class="hljs-constructor">GetAuthenticationInfo(AuthenticationToken <span class="hljs-params">authenticationToken</span>)</span> throws AuthenticationException &#123;<br><br>    <span class="hljs-comment">//明显的知道：这个authenticationToken就是UsernamePasswordtoken</span><br>    UsernamePasswordToken token = (UsernamePasswordToken)authenticationToken;<br>    String username = token.get<span class="hljs-constructor">Username()</span>; <span class="hljs-comment">//拿到用户名(注:这个用户名是传过来的)</span><br><br>    <span class="hljs-comment">//这里根据用户名去获取密码(如果没有获取到，相当于这个用户不存在，就返回陪我)</span><br>    String password = get<span class="hljs-constructor">ByName(<span class="hljs-params">username</span>)</span>;<br>    <span class="hljs-keyword">if</span>(password==null)&#123;<br>        return null;<br>    &#125;<br>    <br>    <span class="hljs-comment">//在这里加盐值需一个ByteSource对象，而Shiro提供了一个ByteSource对象给咱们</span><br>    ByteSource salt = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteSource</span>.</span><span class="hljs-module"><span class="hljs-identifier">Util</span>.</span></span><span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;kongwei_liao&quot;</span>);<br>    <br>    <span class="hljs-comment">//创建一个简单的身份信息(把用户名与密码放进去-注：它会自动的比较获取的密码与你传过来的密码)</span><br>    SimpleAuthenticationInfo authenticationInfo = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleAuthenticationInfo(<span class="hljs-params">username</span>,<span class="hljs-params">password</span>,<span class="hljs-params">salt</span>,<span class="hljs-params">getName</span>()</span>);<br>    return authenticationInfo;<br>&#125;<br><br><span class="hljs-keyword">private</span> String get<span class="hljs-constructor">ByName(String <span class="hljs-params">username</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(username))&#123;<br>        <span class="hljs-comment">// 4a95737b032e98a50c056c41f2fa9ec6: 123456 迭代10次不加盐的结果</span><br>        <span class="hljs-comment">// 922ad745e6fc8a539f70003fa7473336: 123456 迭代10次加盐(kongwei_liao)的结果</span><br>        return <span class="hljs-string">&quot;922ad745e6fc8a539f70003fa7473336&quot;</span>; <span class="hljs-comment">//修改为加密加盐后的数据</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;guest&quot;</span>.equals(username))&#123;<br>        return <span class="hljs-string">&quot;abcd&quot;</span>;<br>    &#125;<br>    return null;<br>&#125;<br></code></pre></td></tr></table></figure>




<h4 id="5、Shiro集成Spring"><a href="#5、Shiro集成Spring" class="headerlink" title="5、Shiro集成Spring"></a>5、Shiro集成Spring</h4><p>我们的项目基本都是通过Spring来管理bean的，如果要想使用Shiro，那就要把shiro集成到Spring。集成Spring的核心就是把框架的核心类(SecurityManager，Subject，Realm)交给Spring管理！</p>
<h5 id="5-1、准备Spring-web项目"><a href="#5-1、准备Spring-web项目" class="headerlink" title="5.1、准备Spring-web项目"></a>5.1、准备Spring-web项目</h5><h5 id="5-2、集成"><a href="#5-2、集成" class="headerlink" title="5.2、集成"></a>5.2、集成</h5><p>导入Shiro包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- shiro的支持包 --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- shiro与Spring的集成包 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>拷贝ShiroFilter配置到web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Spring与shiro集成:需要定义一个shiro过滤器(这是一个代理过滤器，它会到spring的配置中找一个名称相同的真实过滤器) --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>shiroFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>targetFilterLifecycle<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>shiroFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>集成到Spring，拷贝shiro Spring配置到配置文件applicationContext-shiro.xml，在applicationContext.xml中导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-tag"><span class="hljs-string">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 1.配置shiro的核心对象 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;securityManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.web.mgt.DefaultWebSecurityManager&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 配置一个realm，到数据库中获取权限数据 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realm&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;MyRealm&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  2.我们可以自定义一个realm，这个必需实现org.apache.shiro.realm.Realm接口 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MyRealm&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.realm.MyRealm&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--注入密码匹配器--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;property name=&quot;credentialsMatcher&quot;&gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;bean class=&quot;org.apache.shiro.authc.credential.HashedCredentialsMatcher&quot;&gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&amp;lt;!&amp;ndash;加密的方式&amp;ndash;&amp;gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;property name=&quot;hashAlgorithmName&quot; value=&quot;MD5&quot;&gt;&lt;/property&gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&amp;lt;!&amp;ndash;加密次数&amp;ndash;&amp;gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;property name=&quot;hashIterations&quot; value=&quot;10&quot;&gt;&lt;/property&gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;/bean&gt;--&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;/property&gt;--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 3.lifecycleBeanPostProcessor：可以自动调用在Spring Ioc窗口中 Shiro bean的生命周期方法 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;lifecycleBeanPostProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.spring.LifecycleBeanPostProcessor&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 4.启动ioc容器中使用 shiro的注解，但是必需配置在Spring Ioc容器中Shiro bean的生成周期方法 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;lifecycleBeanPostProcessor&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityManager&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;securityManager&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 5.shiro的核心过滤器(注：这个名称必需和web.xml的代表过滤器【DelegatingFilterProxy】名称一样) --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;shiroFilter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityManager&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;securityManager&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- 登录的url,如果没有登录，你访问的路径会跳到这个页面 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/login.jsp&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- 登录成功的url,如果登录成功，会跳转到这个页面 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;successUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/success.jsp&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- 没有权限时跳转到这个位置 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;unauthorizedUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/noPermission.jsp&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!--定义过滤器链--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;filterChainDefinitions&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--anon:匿名过滤器,表示直接放行--&gt;</span><br>                login.jsp = anon<br>                /login = anon<br>                <span class="hljs-comment">&lt;!--注销--&gt;</span><br>                /logout = logout<br>                <span class="hljs-comment">&lt;!--/**：所有请求包括子请求，authc：必须认证通过才放行--&gt;</span><br>                /** = authc<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            配置哪些资源被保护，哪些资源需要权限</span><br><span class="hljs-comment">            anon：不需要登录也可以访问相应的权限</span><br><span class="hljs-comment">            authc：需要权限才能访问</span><br><span class="hljs-comment">              /** ：所有文件及其子文件</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;property name=&quot;filterChainDefinitionMap&quot; ref=&quot;filterChainDefinitionMap&quot;&gt;&lt;/property&gt;--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;bean id=&quot;chainDefinitionMapFactory&quot; class=&quot;cn.itsource.crm.realm.FilterChainDefinitionMapFactory&quot;/&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;bean id=&quot;filterChainDefinitionMap&quot; factory-bean=&quot;chainDefinitionMapFactory&quot; factory-method=&quot;createFilterChainDefinitionMap&quot;/&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引入Shiro的配置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;applicationContext-shiro.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>
<p>测试：除了登录界面能够被正常访问，其他的都要跳转到登录界面！</p>
<h5 id="5-3、小结"><a href="#5-3、小结" class="headerlink" title="5.3、小结"></a>5.3、小结</h5><p>注意：需要一个Spring的环境，不能全部都在SpringMVC那儿初始化</p>
<h4 id="6、Authentication（身份认证）"><a href="#6、Authentication（身份认证）" class="headerlink" title="6、Authentication（身份认证）"></a>6、Authentication（身份认证）</h4><p>在集成Spring的例子中，只有登录页面是不需要登录可以直接访问。其他的页面需要认证（即登录）后才能访问，那怎么来实现登录认证，又叫做身份认证呢？</p>
<p><strong>身份验证：</strong>一般需要提供如身份ID等一些标识信息来表明登录者的身份，如提供email用户名/密码来证明。</p>
<p>在Shiro中用户需要提供principals（身份）和credentiaIs（证明）给Shiro，从而应用能验证用户身份：</p>
<ul>
<li><strong>principals：</strong>身份，即主体的标识属性，可以是田可属性，如用户名、邮箱等，唯一即可。一个主体可以有多个principals，但只有一个Primaryprincipals，一般是用户名/邮箱/手机号。</li>
<li><strong>credentials：</strong>证明/凭证，即只有主体知道的安全值，如密码/数字证书等。</li>
<li>最常见的principals和credentials组合就是用户名/密码了</li>
</ul>
<p>做认证需要用户名和密码，认证流程，如下图：</p>
<p><img src="Shiro/image-20191214195132572.png" srcset="/img/loading.gif" alt="image-20191214195132572"></p>
<h5 id="6-1、详细步骤分析"><a href="#6-1、详细步骤分析" class="headerlink" title="6.1、详细步骤分析"></a>6.1、详细步骤分析</h5><p>要想实现登录，分前台和后台两部分：</p>
<ul>
<li><p>前台：实现一个login.jsp的页面，用来搜集登录信息（用户名和密码）！当点击登录时把登录信息提交到后台完成认证。</p>
</li>
<li><p>后台：写一个Controller接收前台传入的登录信息，完成登录认证。</p>
</li>
</ul>
<p>具体步骤如下：</p>
<ol>
<li><p>创建LoginConroller，写一个方法接收前台登录请求并接受登录信息(用户名和密码)</p>
</li>
<li><p>获取当前的 Subject，调用 SecurityUtils.getSubject();</p>
</li>
<li><p>测试当前的用户是否已经被认证。即是否已经登录. 调用 Subject 的 isAuthenticated() </p>
</li>
<li><p>若没有被认证，则把用户名和密码封装为 UsernamePasswordToken 对象</p>
</li>
<li><p>执行登录: 调用 Subject 的 login(AuthenticationToken) 方法. </p>
</li>
<li><p>自定义 Realm 的方法，从数据库中获取对应的记录, 返回给 Shiro.</p>
<ul>
<li>入门中使用的是Shiro自带的IniRealm，IniRealm从ini配置文件中读取用户的信息，大部分情况下需要从系统的数据库中读取用户信息，所以需要自定义realm。</li>
<li>实际上需要继承 org.apache.shiro.realm.AuthenticatingRealm 类</li>
<li>实现 doGetAuthenticationInfo(AuthenticationToken) 方法. </li>
</ul>
</li>
<li><p>由 shiro 完成对密码的比对.</p>
</li>
</ol>
<h5 id="6-2、简单认证实现"><a href="#6-2、简单认证实现" class="headerlink" title="6.2、简单认证实现"></a>6.2、简单认证实现</h5><p>login.jsp</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stata">&lt;<span class="hljs-keyword">form</span> action=<span class="hljs-string">&quot;/login&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>    用户名&lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;username&quot;</span> /&gt; &lt;<span class="hljs-keyword">br</span> /&gt;<br>    密码:&lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;password&quot;</span> name=<span class="hljs-string">&quot;password&quot;</span> /&gt; &lt;<span class="hljs-keyword">br</span> /&gt;<br>    &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;登录&quot;</span> /&gt;<br>&lt;/<span class="hljs-keyword">form</span>&gt;<br></code></pre></td></tr></table></figure>
<p>LoginController</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Controller<br>public <span class="hljs-keyword">class</span> LoginController &#123;<br>    @<span class="hljs-constructor">RequestMapping(<span class="hljs-string">&quot;/login&quot;</span>)</span><br>    public String login(String username,String password)&#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 获取当前的 Subject. 调用 SecurityUtils.getSubject();</span><br><span class="hljs-comment">         * 测试当前的用户是否已经被认证. 即是否已经登录. 调用 Subject 的 isAuthenticated()</span><br><span class="hljs-comment">         * 若没有被认证, 则把用户名和密码封装为 UsernamePasswordToken 对象</span><br><span class="hljs-comment">         * 执行登录: 调用 Subject 的 login(AuthenticationToken) 方法.</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">//1.拿到访问的主体(当前登录用户)</span><br>        Subject subject = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecurityUtils</span>.</span></span>get<span class="hljs-constructor">Subject()</span>;<br>        <span class="hljs-comment">//2.判断这个用户是否已经登录(通过验证)</span><br>        <span class="hljs-keyword">if</span>(!subject.is<span class="hljs-constructor">Authenticated()</span>)&#123;<br>            <span class="hljs-comment">//3.如果没有验证，就要完成登录</span><br>            UsernamePasswordToken token = <span class="hljs-keyword">new</span> <span class="hljs-constructor">UsernamePasswordToken(<span class="hljs-params">username</span>,<span class="hljs-params">password</span>)</span>;<br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-comment">//4.根据toke完成登录功能</span><br>                subject.login(token);<br>            &#125;catch (UnknownAccountException e)&#123;<br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;用户名不存在！！&quot;</span>);<br>                e.print<span class="hljs-constructor">StackTrace()</span>;<br>            &#125;catch (IncorrectCredentialsException e)&#123;<br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;密码不存在！&quot;</span>);<br>                e.print<span class="hljs-constructor">StackTrace()</span>;<br>            &#125;catch (AuthenticationException e)&#123;<br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;登录出错！&quot;</span>);<br>                e.print<span class="hljs-constructor">StackTrace()</span>;<br>            &#125;<br>        &#125;<br>        return <span class="hljs-string">&quot;redirect:/s/main.jsp&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>JpaRealm</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JpaRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticatingRealm</span> </span>&#123;<br><br>    <span class="hljs-comment">//AuthenticationInfo:认证; 身份验证; 证明</span><br>    <span class="hljs-comment">//登录的时候就会调用这个方法来做验证</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">AuthenticationInfo</span> doGetAuthenticationInfo(<span class="hljs-type">AuthenticationToken</span> token) <span class="hljs-keyword">throws</span> <span class="hljs-type">AuthenticationException</span> &#123;<br>        <span class="hljs-comment">//System.out.println(token.getClass().getName());</span><br>        <span class="hljs-comment">//可以转成相应的token</span><br>        <span class="hljs-comment">//UsernamePasswordToken upToken =(UsernamePasswordToken)token;</span><br>        <span class="hljs-comment">//拿到传过来的用户名</span><br>        <span class="hljs-comment">//String username = upToken.getUsername();</span><br>        <span class="hljs-comment">//自定义Realm中，需要根据用户名到数据库中拿到密码，然后返回给shiro</span><br>        <span class="hljs-comment">//String password = &quot;123456&quot;;</span><br>        <span class="hljs-comment">//身份认证(用户名)</span><br>        <span class="hljs-type">Object</span> principal = token.getPrincipal();<br>        <span class="hljs-type">Object</span> credentials = <span class="hljs-string">&quot;123456&quot;</span>; <span class="hljs-comment">//密码假设是根据用户名到数据库中查询出来的</span><br>        <span class="hljs-comment">// Object principal, Object credentials, String realmName</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleAuthenticationInfo</span>(principal,credentials,getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="6-3、加密认证"><a href="#6-3、加密认证" class="headerlink" title="6.3、加密认证"></a>6.3、加密认证</h5><p>分析：</p>
<p> 1、密码不能明文保存到数据库 加密保存，比对也要加密比对，具体的比对CredentialsMatcher，默认使用就是SimpleCredentialsMatcher，不做加密的比对。要想做md5加密要使用HashedCredentialsMatcher，并且设置加密为md5 </p>
<p>数据库加密保存：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"><br></code></pre></td></tr></table></figure>
<p><img src="Shiro/image-20191214195619630.png" srcset="/img/loading.gif" alt="image-20191214195619630"></p>
<p>加密对比代码实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//完成登录的认证</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException &#123;<br>    UsernamePasswordToken token = (UsernamePasswordToken)authenticationToken;<br>    <span class="hljs-built_in">String</span> username = token.getUsername();<br>    <span class="hljs-built_in">String</span> dbPassword  = findByUsername(token.getUsername());<br>    <span class="hljs-keyword">if</span>(dbPassword==<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    SimpleAuthenticationInfo authorizationInfo = <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(username,dbPassword,getName());<br>    <span class="hljs-keyword">return</span> authorizationInfo;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">findByUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(username))&#123;<br>        <span class="hljs-comment">//这里是没有加盐的结果</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;4a95737b032e98a50c056c41f2fa9ec6&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>设置Realm的匹配值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 2.我们可以自定义一个realm 这个必需实现org.apache.shiro.realm.Realm接口 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;jpaRealm&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.shiro.realm.JpaRealm&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;credentialsMatcher&quot;</span>&gt;</span><br>        &lt;!—设置加密匹配方案--&gt;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.authc.credential.HashedCredentialsMatcher&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 编码的方式使用:md5 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hashAlgorithmName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;MD5&quot;</span>/&gt;</span><br>            <span class="hljs-comment">&lt;!-- 编码的次数:10 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hashIterations&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="Shiro/image-20191214195742239.png" srcset="/img/loading.gif" alt="image-20191214195742239"></p>
<h5 id="6-4、盐值加密认证"><a href="#6-4、盐值加密认证" class="headerlink" title="6.4、盐值加密认证"></a>6.4、盐值加密认证</h5><p>使用盐值加密，盐值加密，更安全！</p>
<p>数据库要加密保存</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@Test<br><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> testHash() throws <span class="hljs-keyword">Exception</span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * algorithmName:加密算法(md5,sha)</span><br><span class="hljs-comment">     *  source:原始密码</span><br><span class="hljs-comment">     *  salt,加盐</span><br><span class="hljs-comment">     *  hashIterations:遍历次数</span><br><span class="hljs-comment">     */</span><br>    SimpleHash simpleHash = <span class="hljs-built_in">new</span> SimpleHash(&quot;MD5&quot;,&quot;123456&quot;,&quot;kongwei_liao&quot;,<span class="hljs-number">10</span>);<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(simpleHash);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>认证时要支持盐值</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//AuthenticationInfo:认证; 身份验证; 证明</span><br><span class="hljs-comment">//登录的时候就会调用这个方法来做验证</span><br><span class="hljs-comment">//进行登录的认证</span><br>@Override<br>protected AuthenticationInfo <span class="hljs-keyword">do</span><span class="hljs-constructor">GetAuthenticationInfo(AuthenticationToken <span class="hljs-params">authenticationToken</span>)</span> throws AuthenticationException &#123;<br>    <span class="hljs-comment">//明显的知道：这个authenticationToken就是UsernamePasswordtoken</span><br>    UsernamePasswordToken token = (UsernamePasswordToken)authenticationToken;<br>    String username = token.get<span class="hljs-constructor">Username()</span>; <span class="hljs-comment">//拿到用户名(注:这个用户名是传过来的)</span><br>    <span class="hljs-comment">//这里根据用户名去获取密码(如果没有获取到，相当于这个用户不存在，就返回陪我)</span><br>    String password = get<span class="hljs-constructor">ByName(<span class="hljs-params">username</span>)</span>;<br>    <span class="hljs-keyword">if</span>(password==null)&#123;<br>        return null;<br>    &#125;<br>    <span class="hljs-comment">//在这里加盐值需一个ByteSource对象，而Shiro提供了一个ByteSource对象给咱们</span><br>    ByteSource salt = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteSource</span>.</span><span class="hljs-module"><span class="hljs-identifier">Util</span>.</span></span><span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;kongwei_liao&quot;</span>);<br>    <span class="hljs-comment">//创建一个简单的身份信息(把用户名与密码放进去-注：它会自动的比较获取的密码与你传过来的密码)</span><br>    SimpleAuthenticationInfo authenticationInfo = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleAuthenticationInfo(<span class="hljs-params">username</span>,<span class="hljs-params">password</span>,<span class="hljs-params">salt</span>,<span class="hljs-params">getName</span>()</span>);<br>    return authenticationInfo;<br>&#125;<br><br><span class="hljs-keyword">private</span> String get<span class="hljs-constructor">ByName(String <span class="hljs-params">username</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(username))&#123;<br>        <span class="hljs-comment">// 4a95737b032e98a50c056c41f2fa9ec6: 123456 迭代10次不加盐的结果</span><br>        <span class="hljs-comment">// 922ad745e6fc8a539f70003fa7473336: 123456 迭代10次加盐(kongwei_liao)的结果</span><br>        return <span class="hljs-string">&quot;922ad745e6fc8a539f70003fa7473336&quot;</span>; <span class="hljs-comment">//修改为加密加盐后的数据</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;guest&quot;</span>.equals(username))&#123;<br>        return <span class="hljs-string">&quot;abcd&quot;</span>;<br>    &#125;<br>    return null;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="6-5、小结"><a href="#6-5、小结" class="headerlink" title="6.5、小结"></a>6.5、小结</h5><p>普通认证、加密认证、加密加盐认证（<strong>采纳</strong>）</p>
<h4 id="7、Authorizing（授权）"><a href="#7、Authorizing（授权）" class="headerlink" title="7、Authorizing（授权）"></a>7、Authorizing（授权）</h4><p>有的资源需要有对应的权限才能访问，如果想要某个用户能够访问某个资源，必须给对应用户授权。</p>
<p>对于授权需要做两个事情：</p>
<ol>
<li><code>权限拦截</code>：当用户访问没有权限的资源时进行拦截</li>
<li><code>权限判断</code>：给用户授权</li>
</ol>
<p>授权，也叫访问控制，即在应用中控制谁访问哪些资源（如访问页面/编辑数据/页面操作等）。在授权中需了解的几个关键对象主体（Subject）、资源（Resource）、权限（Permission）、角色（Role）。</p>
<ol>
<li><code>主体(Subject)</code>：访问应用的用户，在Shiro中使用Subject代表该用户。用户只有授权后才允许访问相应的资源。</li>
<li><code>资源(Resource)</code>：在应用中用户可以访问的URL，比如访问JSP页面、查看/编辑某些数据、访问某个业务方法、打印文本等等都是资源。用户只要授权后才能访问。</li>
<li><code>权限(Permission)</code>：安全策略中的原子授权单位，通过权限我们可以表示在应用中用户有没有操作某个资源的权力。即权限表示在应用中用户能不能访问某个资源，如：访问用户列表页面查看/新增/修改/删除用户数据（即很多时候都是CRUD（增查改删）式权限控制）等。权限代表了用户有没有操作某个资源的权利，即反映在某个资源上的操作允不允许。</li>
<li><code>角色(Role)</code>：权限的集合，一般情况下会赋予用户角色而不是权限即这样用户可以拥有一组权限，赋予权限时比较方便典型的如：项目经理、技术总监、CTO、开发工程师等都是角色，不同的角色拥有一组不同的权限。</li>
</ol>
<p>Shiro支持粗粒度权限（如用户模块的所有权限）和细粒度权限（操作某个用户的权限，即实例级别的）</p>
<h5 id="7-1、Shiro的三种权限判断方式"><a href="#7-1、Shiro的三种权限判断方式" class="headerlink" title="7.1、Shiro的三种权限判断方式"></a>7.1、Shiro的三种权限判断方式</h5><p>编程式：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>通过<span class="hljs-keyword">if</span>/<span class="hljs-keyword">else</span>授权代码块完成<br>Subject subject = SecurityUtils.getSubject();<br><span class="hljs-keyword">if</span>(subject.hasRole(<span class="hljs-string">&quot;admin&quot;</span>)) &#123;<br><span class="hljs-regexp">//</span>有权限<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-regexp">//</span>无权限<br>&#125;<br></code></pre></td></tr></table></figure>
<p>注解式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//通过在执行的Java方法上放置相应的注解完成</span><br><span class="hljs-meta">@RequiresRoles</span>(<span class="hljs-string">&quot;admin&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-comment">//有权限</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>JSP/GSP标签：在JSP/GSP 页面通过相应的标签完成</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs erb"><span class="xml">&lt;%</span><span class="ruby"><span class="hljs-variable">@taglib</span> prefix=<span class="hljs-string">&quot;shiro&quot;</span> uri=<span class="hljs-string">&quot;http://shiro.apache.org/tags&quot;</span></span><span class="xml">%&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">shiro:hasRole</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin&quot;</span>&gt;</span></span><br><span class="xml">&lt;!— 有权限—&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">shiro:hasRole</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>控制哪些资源要做权限拦截，如果不做拦截，直接放行，如果要拦截就要做权限判断</p>
<p>获取用户能够访问资源，如果你访问资源在里面，说明有权限。可以访问，否则不能访问。</p>
<p>不控制直接放行，要控制查看用户是否拥有,如果有直接访问,否则不能访问</p>
<h5 id="7-2、授权拦截"><a href="#7-2、授权拦截" class="headerlink" title="7.2、授权拦截"></a>7.2、授权拦截</h5><p>权限拦截同样需要从数据库中获取权限或角色信息，所以同样需要自定义Realm。</p>
<p>注意：现要权限写死在配置中！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 5.shiro的真实过滤器(注：这个名称必需和web.xml的代表过滤器【DelegatingFilterProxy】名称一样) --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;shiroFilter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityManager&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;securityManager&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 登录的url,如果没有登录，你访问的路径会跳到这个页面 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/s/login.jsp&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 登录成功的url,如果登录成功，会跳转到这个页面 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;successUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/s/main.jsp&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 没有权限时跳转到这个位置 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;unauthorizedUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/s/unauthorized.jsp&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        配置哪些资源被保护，哪些资源需要权限</span><br><span class="hljs-comment">        anon：不需要登录也可以访问相应的权限</span><br><span class="hljs-comment">        authc：需要权限才能访问</span><br><span class="hljs-comment">          /** ：所有文件及其子文件</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;filterChainDefinitions&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span><br>            /s/login.jsp = anon<br>            /login = anon<br>            <span class="hljs-comment">&lt;!--对资源进行权限控制，要控制的资源都应该从数据库查出，现在咱们先写死--&gt;</span><br>            /s/permission.jsp = perms[user:*]<br>            /** = authc<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>自定义的Realm授权：</p>
<p>授权需要继承 AuthorizingRealm 类，并实现其 doGetAuthorizationInfo 方法 </p>
<p>AuthorizingRealm 类继承自 AuthenticatingRealm，但没有实现 AuthenticatingRealm 中的doGetAuthenticationInfo，所以认证和授权只需要继承 AuthorizingRealm 就可以了。同时实现他的两个抽象方法。</p>
<p>具体实现：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> JpaRealm extends AuthorizingRealm &#123;<br>    <span class="hljs-comment">//AuthorizationInfo:授权(是否有权限进入操作)</span><br>    <span class="hljs-comment">// 我们只需要把相应的权限交给Shiro，它就会自动比对</span><br>    @Override<br>    protected AuthorizationInfo <span class="hljs-keyword">do</span><span class="hljs-constructor">GetAuthorizationInfo(PrincipalCollection <span class="hljs-params">principals</span>)</span> &#123;<br>        <span class="hljs-comment">//拿到主体信息(指的就是当前登录用户名) -&gt; 咱们的权限应该是根据当前用户进行查询到的</span><br>        String username = (String) principals.get<span class="hljs-constructor">PrimaryPrincipal()</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;后面需要根据用户名获取资源&quot;</span>+username);<br>        <span class="hljs-comment">//获取权限资源(这里假设已经根据用户名到数据库中获取到了)</span><br>        Set&lt;String&gt; permissions = <span class="hljs-keyword">new</span> HashSet&lt;&gt;<span class="hljs-literal">()</span>;<br>        permissions.add(<span class="hljs-string">&quot;user:*&quot;</span>);<br>        <span class="hljs-comment">//拿到授权对象，并且所有权限交给它</span><br>        SimpleAuthorizationInfo simpleAuthorizationInfo = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleAuthorizationInfo()</span>;<br>        simpleAuthorizationInfo.set<span class="hljs-constructor">StringPermissions(<span class="hljs-params">permissions</span>)</span>;<br>        <span class="hljs-comment">//返回授权对象</span><br>        return simpleAuthorizationInfo;<br>    &#125;<br><br>    <span class="hljs-comment">//AuthenticationInfo:认证; 身份验证; 证明</span><br>    <span class="hljs-comment">//登录的时候就会调用这个方法来做验证</span><br>    @Override<br>    protected AuthenticationInfo <span class="hljs-keyword">do</span><span class="hljs-constructor">GetAuthenticationInfo(AuthenticationToken <span class="hljs-params">token</span>)</span> throws AuthenticationException &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * Object principal：主体(现在就是登录的用户名)</span><br><span class="hljs-comment">         * Object hashedCredentials：编码后的认证密码</span><br><span class="hljs-comment">         * ByteSource credentialsSalt:加盐</span><br><span class="hljs-comment">         * String realmName</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">//身份认证(用户名)</span><br>        Object principal = token.get<span class="hljs-constructor">Principal()</span>;<br>        <span class="hljs-comment">//密码假设是根据用户名到数据库中查询出来的（数据库密码是经过加密的）</span><br>        Object credentials = <span class="hljs-string">&quot;d5a3fedf6c59c2ecbe7f7a6c1a22da37&quot;</span>;<br>        <span class="hljs-comment">//加盐的数据</span><br>        ByteSource byteSource = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteSource</span>.</span><span class="hljs-module"><span class="hljs-identifier">Util</span>.</span></span><span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;itsource&quot;</span>);<br>        return <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleAuthenticationInfo(<span class="hljs-params">principal</span>,<span class="hljs-params">credentials</span>,<span class="hljs-params">byteSource</span>,<span class="hljs-params">getName</span>()</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="7-3、小结"><a href="#7-3、小结" class="headerlink" title="7.3、小结"></a>7.3、小结</h5><p>授权拦截:</p>
<ol>
<li><p>写死</p>
</li>
<li><p>通过factoryBean动态获取</p>
</li>
<li><p>通过Realm获取用户权限返回给框架</p>
</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/02/15/Spring%20Security/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/02/15/Object/">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
