

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.jpg">
  <link rel="icon" type="image/png" href="/img/favicon.jpg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="liaogangwei的个人主页">
  <meta name="author" content="Kongwei_Liao">
  <meta name="keywords" content="black, foolish, positive">
  <title>Spring - Kongwei_Liao</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Kongwei_Liao</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Spring">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Kongwei_Liao
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2019-11-28 14:13" pubdate>
        2019年11月28日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      121
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring</h1>
            
            <div class="markdown-body">
              <h3 id="Spring4"><a href="#Spring4" class="headerlink" title="Spring4"></a>Spring4</h3><p>Spring框架简化JavaEE的开发流程，解决企业级应用开发开发复杂性难题，提升JavaEE软件开发效率。Spring对大部分常用功能进行了封装，比如管理JavaBean，包含创建及销毁，还提供了基于Web的SpringMVC分层架构，支持数据库操作，安全验证等功能。这些功能的实现要依赖<code>DI(Dependency Injection)</code>和<code>AOP(Aspect Oriented Programming)</code>两员大将，我们需掌握Spring中的这两个核心技术，并在实际的软件开发中得以运用。</p>
<p>Spring框架就是实现了AOP功能的DI容器，在DI容器基础上加入AOP就可以不仅做到松耦合开发，还具有面向切面编程的功能。</p>
<h5 id="1-2、三层架构的理解"><a href="#1-2、三层架构的理解" class="headerlink" title="1.2、三层架构的理解"></a>1.2、三层架构的理解</h5><p>表现层 &gt;&gt; 业务层 &gt;&gt; 持久层</p>
<table>
<thead>
<tr>
<th>层</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>表现层(Web)</td>
<td>jsp/servlet等就是表现层</td>
</tr>
<tr>
<td>业务层(service)</td>
<td>处理相应的业务，由表现层调用</td>
</tr>
<tr>
<td>持久层(dao)</td>
<td>做数据的持久化(现在咱们操作数据库就是完成持久化的功能)  JDBC，SpringJDBC,Hibernate,MyBatis</td>
</tr>
</tbody></table>
<p><img src="/2019/11/28/Spring/Spring.png" srcset="/img/loading.gif"></p>
<p>命名规范：</p>
<ol>
<li>dao层：<ul>
<li>dao接口(dao包.): IXxxDAO         IEmployeeDAO</li>
<li>dao实现(dao.impl包.): XxxDAOImpl      EmployeeDAOImpl</li>
</ul>
</li>
<li>service层：<ul>
<li>service的包与dao的包应该在同一层</li>
<li>service接口(service包.): IXxxService     IEmployeeService</li>
<li>service实现(service.impl包.): XxxServiceImpl  EmployeeServiceImpl</li>
</ul>
</li>
</ol>
<p>一般项目的目录结构：一个domain包，一个dao包，一个service包，一个controller包。</p>
<p>controller调用service，service调用dao</p>
<h5 id><a href="#" class="headerlink" title></a></h5><p>模拟完成过去的从Servlet向下调用的过程，通过main方法创建Servlet进行测试</p>
<p>步骤:  新建JavaWeb项目、创建包结构、写代码、访问测试</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">//Controller层</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>	<span class="hljs-comment">// 需要调用service业务层方法</span><br>	<span class="hljs-type">IUserService</span> userService = <span class="hljs-keyword">new</span> <span class="hljs-type">UserServiceImpl</span>();	<br>	<span class="hljs-keyword">protected</span> void service(<span class="hljs-type">HttpServletRequest</span> request, <span class="hljs-type">HttpServletResponse</span> response) &#123;<br>		<span class="hljs-comment">//调用Service层方法</span><br>		<span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt; list = userService.listUser();<br>        ... ...<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">//Service层</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">IUserService</span></span> </span>&#123;<br>	<span class="hljs-comment">// 需要调用dao层方法</span><br>    <span class="hljs-keyword">private</span> IUserDao userDao = <span class="hljs-keyword">new</span> <span class="hljs-type">UserDaoImp</span>();<br>	<span class="hljs-keyword">public</span> List&lt;User&gt; listUser() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.userDao.listUser();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Dao层</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImp</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserDao</span> </span>&#123;<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">listUser</span><span class="hljs-params">()</span> </span>&#123;<br>    	<span class="hljs-comment">// 由dao层数据库访问操作</span><br>    	System.out.println(<span class="hljs-string">&quot;模拟数据库查询得到数据 &quot;</span>);<br>		... ...<br>		<span class="hljs-keyword">return</span> list;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>




<h4 id="Spring进入正题"><a href="#Spring进入正题" class="headerlink" title="Spring进入正题"></a>Spring进入正题</h4><h5 id="在没有Spring框架之前，Java开发中会遇到的难题："><a href="#在没有Spring框架之前，Java开发中会遇到的难题：" class="headerlink" title="在没有Spring框架之前，Java开发中会遇到的难题："></a>在没有Spring框架之前，Java开发中会遇到的难题：</h5><p>1、代码耦合度高</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> </span>&#123;<br>	<span class="hljs-comment">//如果接口和实现类在同一地方存在，那么就是高耦合。</span><br>	<span class="hljs-keyword">private</span> IUserDao userDao = <span class="hljs-keyword">new</span> <span class="hljs-type">UserDaoImpl</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>UserService除了完成业务逻辑功能的实现，还需要把数据通过UserDao进行持久化，所以称UserService依赖于UserDao来完成她的工作，如果UserService离开了UserDao便无法工作；</p>
<p>2、对象间依赖关系繁琐</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">UserServlet</span> &#123;<br>	  <span class="hljs-keyword">private</span> IUserService service;<span class="hljs-comment">//依赖UserService</span><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">UserService</span>&#123;<br>	   <span class="hljs-keyword">private</span> IUserDao dao;<span class="hljs-comment">//依赖UserDao</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>通过代码来<code>创建对象</code>及<code>管理这些对象之间的依赖关系</code>是相当麻烦的一件事。  </p>
<p>3、事务控制繁琐</p>
<p>实际开发中，某一个业务逻辑可能会牵涉多个操作（多个sql），事务开启在 service 层，是极好的。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs lasso">UserService&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-literal">void</span> save(<span class="hljs-params">...</span>)&#123;<br>	  开启事务<span class="hljs-params">...</span><br>      dao.save(<span class="hljs-params">...</span>);<br>      关闭事务<span class="hljs-params">...</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-literal">void</span> update(<span class="hljs-params">...</span>)&#123;<br>	  开启事务<span class="hljs-params">...</span><br>      dao.update(<span class="hljs-params">...</span>);<br>      关闭事务<span class="hljs-params">...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>涉及到事务处理的地方，每次通过代码来实现这些事务的开启和关闭，导致代码重复开发效率低下。  </p>
<h5 id="2-2、Spring框架的出现解决了上述问题"><a href="#2-2、Spring框架的出现解决了上述问题" class="headerlink" title="2.2、Spring框架的出现解决了上述问题"></a>2.2、Spring框架的出现解决了上述问题</h5><p><code>降低耦合度</code>，<code>提高程序的可重用性</code>，<code>提高开发的效率</code>，<code>简化臃肿的代码</code></p>
<img src="/2019/11/28/Spring/image-20191228163850907.png" srcset="/img/loading.gif" alt="image-20191228163850907" style="zoom:150%;">

<h4 id="3、Spring是什么？"><a href="#3、Spring是什么？" class="headerlink" title="3、Spring是什么？"></a>3、Spring是什么？</h4><p>框架，通常指的是为了实现某个业界标准或完成特定基本任务的软件组件规范，也指为了实现某个软件组件规范时，提供规范所要求之基础功能的软件产品。</p>
<p>框架就是制定一套规范或者规则（思想），大家（程序员）在该规范下工作。或者说使用别人搭好的舞台来做编剧和表演。</p>
<p>Spring是一个开放源代码的设计层面框架，他解决的是业务逻辑层和其他各层的松耦合问题，任何Java应用都可以从Spring中受益。简单来说，Spring是一个分层的JavaSE/EEfull-stack(一站式) 轻量级开源框架。</p>
<p>Spring是全面的和模块化的。Spring有分层的体系结构，你可以选择使用Spring来简单化JDBC的使用，或用来管理所有的业务对象。</p>
<h4 id="4、Spring核心"><a href="#4、Spring核心" class="headerlink" title="4、Spring核心"></a>4、Spring核心</h4><h5 id="4-1、IOC控制反转"><a href="#4-1、IOC控制反转" class="headerlink" title="4.1、IOC控制反转"></a>4.1、IOC控制反转</h5><p><code>IOC(Inverse Of Control)控制反转</code>：</p>
<p>所谓控制反转就是把对象（bean）创建和维护对象（bean）之间的关系的权利转移到Spring容器中去了（applicationContext.xml）而程序本身不在维护了。</p>
<p>目的是将调用者和被调用者分离，将类与类之间的关系解耦，是一种设计思想。  </p>
<p><code>DI(Dependency Injection)依赖注入</code>：</p>
<p><strong>实际上DI和IOC是同一个概念</strong>，依赖注入和控制反转是对同一件事情的不同描述<strong>。</strong>因为在applicationContext.xml配置文件中bean和bean之间通过ref来维护的时候是相互依赖的，所以又叫做依赖注入，也就是控制反转。  </p>
<p>在没有Spring框架时，如果在A.java类中使用B.java类，则必须在A.java类中实例化出B.java类对象，如此便造成了A和B类的紧耦合，A类完全依赖于B类的功能实现，这样的情况就是典型的“侵入式开发”。随着软件业务复杂度的提升，当原有的B类不能满足A的功能实现时，就需要创建更为高级的BExt.java类，结果就造成了需要把A中所有实例化B.java类的代码替换成new BExt() 代码。产生的源代码的大幅改动，不利于软件运行的稳定，并不符合商业软件的开发流程，Spring的DI就可以解决这样的情况。</p>
<p>其解决办法就是使用<code>反射技术</code>，来动态的对一个类中的属性进行反射复制。这样的功能Spring形成了一个模块，模块的功能非常强大，并且Spring把这种机制进行命名，叫做依赖注入。</p>
<p>DI侧重于实现，A类依赖于B类，B类的对象由容器创建，容器在对A类中的B类属性进行对象值的注入。DI在Java底层技术原理就是“反射”，使用反射技术对某一个类中的属性进行动态赋值，来达到A类与B类之间的解耦。</p>
<p>Spring的DI其实就是对JavaBean的属性使用反射技术进行赋值。当有许多JavaBean需要这样操作时，这些JavaBean的管理就成了问题，有的需要关联有的不需要关联，但所有的这些JavaBean的创建，销毁都要同一调度，由Spring框架处理他们的生命周期。为了方便这种管理，Spring框架提供了DI容器，对JavaBean统一组织，便于后期维护。</p>
<p>总结：对象的关系依赖于容器注入，由容器管理，而对象自己不需要管理。</p>
<img src="/2019/11/28/Spring/image-20191228164413418.png" srcset="/img/loading.gif" alt="image-20191228164413418" style="zoom:200%;">

<h5 id="4-2、AOP面向切面"><a href="#4-2、AOP面向切面" class="headerlink" title="4.2、AOP面向切面"></a>4.2、AOP面向切面</h5><p><code>AOP为Aspect Oriented Programming的缩写</code>，意为：</p>
<p><strong>面向切面编程</strong>，通过<code>预编译方式</code>和<code>运行期动态代理</code>实现程序功能的统一维护的一种技术。AOP是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<p>AOP采取<code>横向抽取</code>机制，取代了传统<code>纵向继承</code>体系重复性代码；</p>
<p>AOP可以用于：日志记录，性能统计，安全控制，事务处理，异常处理和缓存等等；</p>
<p>Spring AOP使用纯Java实现，不需要专门的编译过程和类加载器，在运行期通过代理方式向目标类织入增强代码</p>
<p>AspectJ是一个基于Java语言的AOP框架，Spring2.0开始，Spring AOP引入对Aspect的支持，AspectJ扩展了Java语言，提供了一个专门的编译器，在编译时提供横向代码的织入</p>
<p>总结：Spring使用AOP的功能完成各种共用的模板功能<strong>，</strong>使得我们的业务代码与其它代码分开，Spring是一个轻量级控制反转(IoC)和面向切面(AOP)的<code>容器框架</code>。</p>
<h4 id="5、Spring入门案例"><a href="#5、Spring入门案例" class="headerlink" title="5、Spring入门案例"></a>5、Spring入门案例</h4><h5 id="5-1、引入步骤"><a href="#5-1、引入步骤" class="headerlink" title="5.1、引入步骤"></a>5.1、引入步骤</h5><ol>
<li><p>创建一个工程，用来演示Spring的入门案例；</p>
</li>
<li><p>使用Spring的功能，需要导入Spring相关的包；</p>
</li>
<li><p>创建由Spring管理的类对象；</p>
</li>
<li><p>创建配置文件，配置bean对象，Spring通过解析配置文件，获取对象信息；</p>
</li>
<li><p>这里我们先通过单元测试的方法运行，之后我们会学习Spring的测试模块。</p>
</li>
</ol>
<h5 id="5-2、导包"><a href="#5-2、导包" class="headerlink" title="5.2、导包"></a>5.2、导包</h5><p>spring-framework-4.1.2.RELEASE</p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_09-40-42.png" srcset="/img/loading.gif"></p>
<p><strong>1、核心基础包：</strong></p>
<p><img src="/2019/11/28/Spring/image-20191213221515169.png" srcset="/img/loading.gif" alt="image-20191213221515169"></p>
<p><strong>2、日志包</strong></p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_09-42-35.png" srcset="/img/loading.gif"></p>
<p>目前就先导入核心包(core)和beans包【最小配置包】</p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_09-44-16.png" srcset="/img/loading.gif"></p>
<p>导包的时候注意，现在使用Spring，要完成最小导包，即：需要什么jar包，我们就导入哪一个jar包，这个对咱们认识框架的包是非常有帮助的。不然以后由于出现问题自己都不知道应该怎么解决。</p>
<h5 id="5-3、准备对象类"><a href="#5-3、准备对象类" class="headerlink" title="5.3、准备对象类"></a>5.3、准备对象类</h5><p>在domain包中创建新的实体类，亦即Javabean，如下：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">//User.java</span><br><span class="hljs-keyword">package</span> cn.kongwei_liao.spring.Domain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>	<span class="hljs-comment">//省略了getter和setter方法</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="5-4、XML配置文件"><a href="#5-4、XML配置文件" class="headerlink" title="5.4、XML配置文件"></a>5.4、XML配置文件</h5><p>Spring通过这个配置文件解析对象信息，此Spring配置文件的名称和放置的位置没有固定要求。</p>
<p>但是,建议配置文件命为: <strong>applicationContext.xml</strong>， 放到<code>Resources属性的目录</code>下。</p>
<p>该配置文件的基本信息如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>	<br>  <span class="hljs-comment">&lt;!--目前现在上面基本配置里加入如下一条，在&lt;beans&gt;中--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.Domain.User&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>或使用英文文档中的配置：</p>
<p><img src="/2019/11/28/Spring/app.xml.png" srcset="/img/loading.gif"></p>
<p>引入约束：XMLcatalog，位置：spring-framework-3.2.0.RELEASE\schema\beans目录下</p>
<h5 id="5-5、代码测试"><a href="#5-5、代码测试" class="headerlink" title="5.5、代码测试"></a>5.5、代码测试</h5><p>我们第一步是要启动框架，而启动框架则需要拿到Spring的核心对象；</p>
<p>第一个核心对象是<strong>BeanFactory</strong> : 顾名思义，这是一个创建Bean的工厂</p>
<p>因此：我们的第一步读取配置文件，拿到BeanFactory工厂</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> testHelloSpring &#123;<br>    @Test<br>    public void test<span class="hljs-constructor">Hello()</span>&#123;<br>    <br>        <span class="hljs-comment">//第一步：读取资源文件</span><br>        <span class="hljs-comment">//String xmlPath=&quot;...&quot;;</span><br>        Resource resource = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ClassPathResource(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>)</span>;<br>        <br>        <span class="hljs-comment">//第二步：拿到核心对象 BeanFactory</span><br>        <span class="hljs-comment">//BeanFactory factory = new XmlBeanFactory(xmlPath);</span><br>        BeanFactory factory = <span class="hljs-keyword">new</span> <span class="hljs-constructor">XmlBeanFactory(<span class="hljs-params">resource</span>)</span>;<br>        <br>        <span class="hljs-comment">//第三步：从工厂中拿到一个Bean对象</span><br>        User user = (User)factory.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;user&quot;</span>)</span>;<br>        <br>        user.set<span class="hljs-constructor">Name(<span class="hljs-string">&quot;工厂财源广进&quot;</span>)</span>;<br>        user.set<span class="hljs-constructor">Age(8)</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>




<h5 id="5-6、案例小结"><a href="#5-6、案例小结" class="headerlink" title="5.6、案例小结"></a>5.6、案例小结</h5><ol>
<li><p>利用 Spring容器，帮助我们创建管理对象；</p>
</li>
<li><p>需要导入 Spring 相关的jar包；</p>
</li>
<li><p>需要创建并配置applicationContext.xml文件；</p>
</li>
<li><p>Spring通过解析配置文件，拿到核心对象BeanFactory，帮我们创建管理对象。</p>
</li>
</ol>
<h4 id="6、Spring原理分析"><a href="#6、Spring原理分析" class="headerlink" title="6、Spring原理分析"></a>6、Spring原理分析</h4><p>通过之前的Spring入门案例，知道的Spring的核心就是一个容器，它会根据配置创建相应的bean(对象)，那它的具体实现原理是怎样的呢？就需要我们来在学习一下<code>Spring的核心接口BeanFactory</code>和<code>ApplicationContext</code>，并了解一下Spring创建对象的原理。</p>
<p><img src="/2019/11/28/Spring/image-20191228165021684.png" srcset="/img/loading.gif" alt="image-20191228165021684"></p>
<h5 id="6-1、核心接口BeanFactory"><a href="#6-1、核心接口BeanFactory" class="headerlink" title="6.1、核心接口BeanFactory"></a>6.1、核心接口BeanFactory</h5><p>SpringIoC容器：<strong>BeanFactory(com.springframework.beans.factory.BeanFactory)是Spring框架最核心的一个接口</strong>，spring使用BeanFactory来<strong>实例化、配置和管理Bean对象</strong>，但是它只是一个接口，里面有一个getBean()方法。</p>
<h6 id="6-1-1、使用BeanFactory"><a href="#6-1-1、使用BeanFactory" class="headerlink" title="6.1.1、使用BeanFactory"></a>6.1.1、使用BeanFactory</h6><p>方式一：通过id直接拿到相应的Bean对象（常见方法）</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//通过applicationContext.xml配置文件中配置的bean的id拿到对象</span><br>MyBean bean = (MyBean)factory.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;myBean&quot;</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean);<br></code></pre></td></tr></table></figure>
<p>方式二：通过id与对象的class拿到Bean对象，好处：不需要强转</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//通过id与对象的class拿到bean对象</span><br>MyBean bean = factory.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;myBean&quot;</span>,MyBean.<span class="hljs-params">class</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean);<br></code></pre></td></tr></table></figure>
<p>方式三：通过class拿到Bean对象  </p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//通过id与对象的class拿到bean对象</span><br>MyBean bean = factory.get<span class="hljs-constructor">Bean(MyBean.<span class="hljs-params">class</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean);<br><span class="hljs-comment">//限制：这个class类在配置中只能出现一次</span><br><span class="hljs-comment">//异常：org.springframework.beans.factory.NoUniqueBeanDefinitionException</span><br></code></pre></td></tr></table></figure>
<h6 id="6-1-2、通过class拿到Bean对象的限制"><a href="#6-1-2、通过class拿到Bean对象的限制" class="headerlink" title="6.1.2、通过class拿到Bean对象的限制"></a>6.1.2、通过class拿到Bean对象的限制</h6><p>如果是以下情况，方式三会出错，而方式一与方式二不会出错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>	<span class="hljs-comment">&lt;!-- 不同的bean配置中不能存在class相同的情况 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.domain.User&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;User1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.domain.User&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>思考一下，为什么会这样？</p>
<p>方式三的错误提示：Spring找到两个对象User和User1，两者都属于UserInfo.class的对象。Spring并<code>不确定</code>应该获取哪一个，所以出现了异常。</p>
<ul>
<li><p>方式一：根据id拿，可以<code>确定</code></p>
</li>
<li><p>方式二：也是根据id拿，可以<code>确定</code>(不需要强转)</p>
</li>
<li><p>方式三：根据类型，现在有两个类型相等，无法确定(报错)</p>
</li>
</ul>
<p>以后大家会发现，包括BeanFactory这个对象都是Spring自己创建的，而不需要我们自己使用这三种方式手动创建，但是在Spring内部是通过这些方式去拿到Bean的。</p>
<h5 id="6-2、ApplicationContext"><a href="#6-2、ApplicationContext" class="headerlink" title="6.2、ApplicationContext"></a>6.2、ApplicationContext</h5><p>应用上下文：ApplicationContext(com.springframework.context.ApplicationContext)</p>
<p>建立在BeanFactory基础之上，提供了更多面向应用的功能，它提供了国际化支持和框架事件体系，更易于创建实际应用。</p>
<p>对于二者的用途，我们可以进行简单的划分:</p>
<ul>
<li><p>BeanFactory是Spring框架的基础设施，<code>面向Spring本身</code>；</p>
</li>
<li><p>ApplicationContext<code>面向使用Spring框架的开发者</code>。</p>
</li>
</ul>
<p>应用上下文ApplicationContext是建立在BeanFactory基础上的一种更高层次的Spring IoC容器，其除了具有普通BeanFactory的全部功能以外，还加入了以下功能：</p>
<ul>
<li><p>提供了I18N的支持；</p>
</li>
<li><p>提供了资源访问；</p>
</li>
<li><p>提供了载入文件资源的通用方法；</p>
</li>
<li><p>提供了发送事件的功能。</p>
</li>
</ul>
<p>几乎所有的应用场合都可以直接使用ApplicationContext，而非底层的BcanFactory。</p>
<h6 id="6-2-1、使用ApplicationContext"><a href="#6-2-1、使用ApplicationContext" class="headerlink" title="6.2.1、使用ApplicationContext"></a>6.2.1、使用ApplicationContext</h6><p>使用一个ApplicationContext来完成拿到Bean的功能：</p>
<p>要使用ApplicationContext的功能，必需要导入相应的jar包</p>
<p><code>spring-context-4.1.2.RELEASE.jar</code> 与 <code>spring-expression-4.1.2.RELEASE.jar</code></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">//拿到核心对象 ApplicationContext<br>//ClassPathXmlApplicationContext 用于加载classpath（类路径、src）下的xml<br>//FileSystemXmlApplicationContext 用于加载指定盘符下的xml<br>ApplicationContext context = new ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br><br><span class="hljs-keyword">User</span> <span class="hljs-title">bean</span> = (User) context.getBean(<span class="hljs-string">&quot;User&quot;</span>);<br>System.out.println(bean);<br></code></pre></td></tr></table></figure>


<h5 id="6-3、ApplicationContext与BeanFactory的区别-面试题"><a href="#6-3、ApplicationContext与BeanFactory的区别-面试题" class="headerlink" title="6.3、ApplicationContext与BeanFactory的区别 ( 面试题 )"></a>6.3、ApplicationContext与BeanFactory的区别 ( 面试题 )</h5><p>解释：ApplicationContext是BeanFactory的子接口，拥有更多的功能与方法；</p>
<p>重点：ApplicationContext对bean是在读取的时候就创建Bean对象；</p>
<p>而BeanFactory是在使用的时候才进行对象的创建 ( 懒加载 )</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//这句代码已经创建Bean（ApplicationContext即时加载）</span><br>ApplicationContext context = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>)</span>; <br><br><span class="hljs-comment">//下面这句还没有创建（BeanFactory懒加载） 使用的时候才加载</span><br><span class="hljs-comment">//读取资源文件</span><br>ClassPathResource resource = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ClassPathResource(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>)</span>;<br><span class="hljs-comment">//创建BeanFactory</span><br>BeanFactory beanFactory = <span class="hljs-keyword">new</span> <span class="hljs-constructor">XmlBeanFactory(<span class="hljs-params">resource</span>)</span>;<br>UserDao userDao1 = 	(UserDao)beanFactory.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;userDao&quot;</span>)</span>;<span class="hljs-comment">//需要时才加载</span><br></code></pre></td></tr></table></figure>
<p><strong>扩展</strong>：我们在使用ApplicationContext的时候，可以通过配置让它也变成与BeanFactory一样的懒加载：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 让其中一个Bean变成懒加载 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.MyBean&quot;</span> <span class="hljs-attr">lazy-init</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h4 id="7、BeanFactory模拟实现"><a href="#7、BeanFactory模拟实现" class="headerlink" title="7、BeanFactory模拟实现"></a>7、BeanFactory模拟实现</h4><p>模拟步骤：</p>
<ol>
<li>使用简单工厂模式来处理bean容器。</li>
<li>解析xml文件，获取配置中的元素信息。</li>
<li>利用反射获实例化配置信息中的对象。</li>
<li>如果有对象注入，使用invoke()方法。</li>
<li>实例化的对象放入bean容器中，并提供getBean方法。</li>
</ol>
<p>简化版的BeanFactory代码：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> BeanFactory &#123;<br>     <br>    <span class="hljs-comment">//bean容器</span><br>	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; contianer = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;<span class="hljs-literal">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &lt;p&gt;Discription:通过bean的id在容器中获取bean对象&lt;/p&gt;</span><br><span class="hljs-comment">     * @param beanName bean的唯一标识id</span><br><span class="hljs-comment">     */</span><br>    public Object get<span class="hljs-constructor">Bean(String <span class="hljs-params">beanName</span>)</span> &#123;<br>        Object obj = contianer.get(beanName);<br>        return obj;<br>    &#125;<br>     <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &lt;p&gt;Discription:bean工厂的初始化&lt;/p&gt;</span><br><span class="hljs-comment">     * @param xml xml配置文件路径</span><br><span class="hljs-comment">     */</span><br>    public void init(String xml) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 读取指定的配置文件</span><br>            SAXReader reader = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SAXReader()</span>;<br>            ClassLoader classLoader = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>current<span class="hljs-constructor">Thread()</span>.get<span class="hljs-constructor">ContextClassLoader()</span>;<br>            <span class="hljs-comment">// 从class目录下获取指定的xml文件</span><br>            Document doc = reader.read(classLoader.get<span class="hljs-constructor">ResourceAsStream(<span class="hljs-params">xml</span>)</span>);<br>            Element root = doc.get<span class="hljs-constructor">RootElement()</span>;<br>            Iterator iter = root.element<span class="hljs-constructor">Iterator()</span>;<br><br>            <span class="hljs-keyword">while</span> (iter.has<span class="hljs-constructor">Next()</span>) &#123;<br>                Element ele = (Element) iter.next<span class="hljs-literal">()</span>;<br>                <span class="hljs-comment">// 获取bean的属性id和class</span><br>                String id = ele.attribute<span class="hljs-constructor">Value(<span class="hljs-string">&quot;id&quot;</span>)</span>;<br>                String beanClassName = ele.attribute<span class="hljs-constructor">Value(<span class="hljs-string">&quot;class&quot;</span>)</span>;<br>                <span class="hljs-comment">// 利用Java反射机制，通过class的名称获取Class对象</span><br>                Class&lt;?&gt; bean = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-params">beanClassName</span>)</span>;<br>                <span class="hljs-comment">// 获取对应class的信息</span><br>                java.beans.BeanInfo info = java.beans.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Introspector</span>.</span></span>get<span class="hljs-constructor">BeanInfo(<span class="hljs-params">bean</span>)</span>;<br>                <span class="hljs-comment">// 获取其属性描述</span><br>                java.beans.PropertyDescriptor pds<span class="hljs-literal">[]</span> = info.get<span class="hljs-constructor">PropertyDescriptors()</span>;<br>                <span class="hljs-comment">// 创建一个对象</span><br>                Object obj = bean.<span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>;<br>                <span class="hljs-comment">// 遍历该bean的property属性</span><br>                Iterator&lt;Element&gt; iterator = ele.element<span class="hljs-constructor">Iterator(<span class="hljs-string">&quot;property&quot;</span>)</span>;<br>                <span class="hljs-keyword">while</span>(iterator.has<span class="hljs-constructor">Next()</span>)&#123;<br>                    Element propElem = iterator.next<span class="hljs-literal">()</span>;<br>                    String propertyName = propElem.attribute<span class="hljs-constructor">Value(<span class="hljs-string">&quot;name&quot;</span>)</span>;<br>                    <span class="hljs-comment">// 获取该property的子元素value的值</span><br>                    String value = propElem.attribute<span class="hljs-constructor">Value(<span class="hljs-string">&quot;value&quot;</span>)</span>;<br>                    <span class="hljs-comment">// 利用Java的反射机制调用对象的某个set方法，并将值设进去</span><br>                    <span class="hljs-keyword">for</span> (PropertyDescriptor pd : pds) &#123;<br>                        <span class="hljs-keyword">if</span> (pd.get<span class="hljs-constructor">Name()</span>.equals(propertyName)) &#123;<br>                            pd.get<span class="hljs-constructor">WriteMethod()</span>.invoke(obj, value);<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-comment">// 将对象放入beanMap中，其中key为id值，value为对象</span><br>                contianer.put(id, obj);<br>            &#125;<br>        &#125; catch (Exception e) &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(e.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>        &#125;<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure>
<p>上面的代码简单的模拟实现了BeanFactory的功能，Spring框架里面的代码要比我们这个复杂的多，因为要考虑到安全性、稳定性、异常等等因素，但是原理都一样。</p>
<p><strong>模拟案例总结：</strong></p>
<ul>
<li>Spring通过 xml配置文件 + dom解析 + 反射 + 工厂方法 实现对象的创建。</li>
<li>BeanFactory 的本质就是一个Bean工厂，内部维护了一个对象容器。</li>
<li>Applicationcontext 继承了BeanFactory 接口对外开放（推荐使用）。</li>
</ul>
<h4 id="8、配置文件详解"><a href="#8、配置文件详解" class="headerlink" title="8、配置文件详解"></a>8、配置文件详解</h4><h5 id="8-1、基本配置"><a href="#8-1、基本配置" class="headerlink" title="8.1、基本配置"></a>8.1、基本配置</h5><p>我们已经演示了Spring框架管理对象的基本配置，并了解到<code>Spring的原理是一个解析xml配置标签的容器工厂</code>，现在我们来详细了解一下常用的标签。</p>
<p>他们包括bean标签、作用域标签和声明周期标签等：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 最基本的配置 id/name class --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.User&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span> <br></code></pre></td></tr></table></figure>
<p>bean标签用于描述需要被Spring的DI容器管理的对象：</p>
<ul>
<li><p>id属性：标识配置的bean，唯一且不能有特殊符号【Spring3.2前】；</p>
</li>
<li><p>name属性：由于历史遗留和id功能相同，建议使用id，可以使用特殊符号，Spring3.2后不区分id，name；</p>
</li>
<li><p>class属性：配置bean的完全限定名，虽是全限定名但是没有后缀；</p>
</li>
<li><p>scope属性：<br>通过scope属性，指定Bean的作用范围，取值通常有一下几种:</p>
<ul>
<li><p><code>singleton</code>：默认值，单例</p>
<p>singleton 对象在容器起动的时候创建，并且只创建一次，容器中只有一个该对象；</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;cn.itsource.spring.domain.User&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;singleton&quot;</span>&gt;&lt;/bean&gt; <br></code></pre></td></tr></table></figure>
</li>
<li><p><code>prototype</code>：多实例</p>
<p>prototype 对象在每次从容器中调用时才创建，每次都是返回一个新的实例（相当于new XxxBean()）</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.domain.User&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>&gt;&lt;/bean&gt; <br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> fun4() throws <span class="hljs-keyword">Exception</span> &#123;<br>ApplicationContext ac = <span class="hljs-built_in">new</span> ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);<br>  	<span class="hljs-keyword">User</span> user1 = (<span class="hljs-keyword">User</span>) ac.getBean(&quot;user&quot;);<br>  	<span class="hljs-keyword">User</span> user2 = (<span class="hljs-keyword">User</span>) ac.getBean(&quot;user&quot;);<br>  	<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(user1==user2);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><code>request</code>：Web应用上下文中，创建一个对象，存放到request域中</p>
</li>
<li><p><code>session</code>：Web应用上下文中，创建一个对象，存放到session域中</p>
</li>
<li><p><code>globalSession</code>：Web应用上下文中，一般用于Portlet应用环境</p>
</li>
</ul>
</li>
</ul>
<h5 id="8-2、Bean的种类"><a href="#8-2、Bean的种类" class="headerlink" title="8.2、Bean的种类"></a>8.2、Bean的种类</h5><p>l 普通bean：之前操作的都是普通bean。&lt;bean id=”” class=”A”&gt; ，spring直接创建A实例，并返回</p>
<p>l FactoryBean：是一个特殊的bean，具有工厂生成对象能力，只能生成特定的对象。</p>
<p>​    bean必须使用 FactoryBean接口，此接口提供方法 getObject() 用于获得特定bean。</p>
<p>​    &lt;bean id=”” class=”FB”&gt; 先创建FB实例，使用调用getObject()方法，并返回方法的返回值</p>
<p>​        FB fb = new FB();</p>
<p>​        return fb.getObject();</p>
<p>l BeanFactory 和 FactoryBean 对比？</p>
<p>​    BeanFactory：工厂，用于生成任意bean。</p>
<p>​    FactoryBean：特殊bean，用于生成另一个特定的bean。例如：ProxyFactoryBean ，此工厂bean用于生产代理。&lt;bean id=”” class=”….ProxyFactoryBean”&gt; 获得代理对象实例。AOP使用</p>
<h5 id="8-2、生命周期配置"><a href="#8-2、生命周期配置" class="headerlink" title="8.2、生命周期配置"></a>8.2、生命周期配置</h5><p>生命周期：构造 -&gt; 初始化-&gt; 运行-&gt; 销毁</p>
<p><strong>注：配置多例的情况下，不会执行销毁</strong></p>
<p><strong>1、修改User类：添加init 和 destroy 方法</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> <span class="hljs-keyword">User</span> &#123;<br>	<span class="hljs-built_in">public</span> <span class="hljs-type">void</span> init()&#123;<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;初始化方法&quot;);<br>	&#125;<br>	<span class="hljs-built_in">public</span> <span class="hljs-type">void</span> destroy()&#123;<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;销毁&quot;);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>2、配置信息</strong></p>
<p>singleton 单例模式（默认是单例模式）：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ocaml">&lt;bean id=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.domain.User&quot;</span> init-<span class="hljs-keyword">method</span>=<span class="hljs-string">&quot;init&quot;</span> destroy-<span class="hljs-keyword">method</span>=<span class="hljs-string">&quot;destroy&quot;</span> &gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p>prototype 多实例：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.Domain.User&quot;</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-string">&quot;init&quot;</span> <span class="hljs-attribute">destroy-method</span>=<span class="hljs-string">&quot;destroy&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p><strong>3、测试方法</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Test<br>public void test<span class="hljs-constructor">GetBean()</span> throws Exception &#123;<br>ApplicationContext context = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>)</span>;<br>	User bean = (User) context.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;User&quot;</span>)</span>;<br>	bean.set<span class="hljs-constructor">Name(<span class="hljs-string">&quot;Kongwei_Liao&quot;</span>)</span>;<br>    bean.set<span class="hljs-constructor">Age(22)</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean.get<span class="hljs-constructor">Name()</span>);<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean);<br>    <br>	<span class="hljs-comment">//ApplicationContext接口没有定义registerShutdownHook方法</span><br>	context.register<span class="hljs-constructor">ShutdownHook()</span>;<span class="hljs-comment">//关闭spring容器</span><br>	<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;?&quot;</span>+bean.get<span class="hljs-constructor">Name()</span>);<br>	User bean1 = (User)context.get<span class="hljs-constructor">Bean(<span class="hljs-string">&quot;User&quot;</span>)</span>;<br>    bean1.set<span class="hljs-constructor">Name(<span class="hljs-string">&quot;Jie_Liu&quot;</span>)</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean1.get<span class="hljs-constructor">Name()</span>);<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(bean.get<span class="hljs-constructor">Name()</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>4、结果</strong></p>
<p>注：打印的包路径名，因为文档的内容后期改动ant_nest为kongwei_liao。</p>
<p>singleton 单例模式结果：</p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_16-37-51.png" srcset="/img/loading.gif"></p>
<p>prototype 多实例：</p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_17-16-15.png" srcset="/img/loading.gif"></p>
<p>小结:</p>
<ul>
<li>加载容器 -&gt; 创建对象 -&gt; 初始化-&gt; 运行-&gt; 销毁；</li>
<li>初始化又分BeanFactory和ApplicationContext两类；</li>
<li>init-method=”init” 初始化对象后调用的方法；</li>
<li>destroy-method=”destroy” 关闭容器前调用的方法。</li>
</ul>
<h5 id="8-4、BeanPostProcessor-后处理Bean"><a href="#8-4、BeanPostProcessor-后处理Bean" class="headerlink" title="8.4、BeanPostProcessor 后处理Bean"></a>8.4、BeanPostProcessor 后处理Bean</h5><p>spring 提供一种机制，只要实现此接口BeanPostProcessor，并将实现类提供给spring容器，spring容器将自动执行，在初始化方法前执行before()，在初始化方法后执行after() 。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> MyBeanPostProcessor implements BeanPostProcessor &#123;<br><br>	@Override<br>	<span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> postProcessBeforeInitialization(<span class="hljs-keyword">Object</span> bean, String beanName) throws BeansException &#123;<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;前方法 ： &quot; + beanName);<br>		<span class="hljs-keyword">return</span> bean;<br>	&#125;<br><br>	@Override<br>	<span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> postProcessAfterInitialization(final <span class="hljs-keyword">Object</span> bean, String beanName) throws BeansException &#123;<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;后方法 ： &quot; + beanName);<br>		// bean 目标对象<br>		// 生成 jdk 代理<br>		<span class="hljs-keyword">return</span> Proxy.newProxyInstance(<br>					MyBeanPostProcessor.<span class="hljs-keyword">class</span>.getClassLoader(), <br>					bean.getClass().getInterfaces(), <br>					<span class="hljs-built_in">new</span> InvocationHandler()&#123;<br>						@Override<br>						<span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> invoke(<span class="hljs-keyword">Object</span> proxy, <span class="hljs-keyword">Method</span> <span class="hljs-keyword">method</span>, <span class="hljs-keyword">Object</span>[] args) throws Throwable &#123;<br>							<br>							<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;------开启事务&quot;);<br>							<br>							//执行目标方法<br>							<span class="hljs-keyword">Object</span> obj = <span class="hljs-keyword">method</span>.invoke(bean, args);<br>							<br>							<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;------提交事务&quot;);<br>							<span class="hljs-keyword">return</span> obj;<br>						&#125;&#125;);<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 将后处理的实现类注册给spring --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.e_lifecycle.MyBeanPostProcessor&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">	问题1：后处理bean作用某一个目标类，还是所有目标类？	所有</span><br><span class="hljs-comment">	问题2：如何只作用一个？	通过“参数2”beanName进行控制</span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure>



<h5 id="8-3、配置文件总结"><a href="#8-3、配置文件总结" class="headerlink" title="8.3、配置文件总结"></a>8.3、配置文件总结</h5><p>bean标签用于描述需要被spring容器管理的对象；</p>
<p><strong>一般我们自己不会来配置scope和 生命周期，而这个基本上由Spring自身来使用；</strong></p>
<p>例如在Spring操作连接池的时候，它会在DateSource销毁的时候执行。</p>
<h4 id="9、Spring单元测试"><a href="#9、Spring单元测试" class="headerlink" title="9、Spring单元测试"></a>9、Spring单元测试</h4><p>之前的测试，我们是通过Junit或者main方法，其实在使用Spring框架的时候，我们经常使用的是Spring提供的测试模块。可以简化很多操作。</p>
<h5 id="9-1、Spring-Test测试原理"><a href="#9-1、Spring-Test测试原理" class="headerlink" title="9.1、Spring Test测试原理"></a>9.1、Spring Test测试原理</h5><p>Spring测试主要是Spring-junit，这个是Spring自己专门写的一套测试框架功能。</p>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_15-25-56.png" srcset="/img/loading.gif"></p>
<h5 id="9-2、使用步骤"><a href="#9-2、使用步骤" class="headerlink" title="9.2、使用步骤"></a>9.2、使用步骤</h5><p>1、导入Spring-Test依赖包 </p>
<p>2、添加注解</p>
<p>@RunWith()、@ContextConfiguration 和 @Autowired</p>
<p>在测试类上打 @RunWith() 注解<strong>，</strong>创建容器;</p>
<p>在打上@ContextConfiguration()注解，指定创建容器的时候使用哪个配置文件；</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RunWith</span>(SpringJUnit4ClassRunner.class)<br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;classpath:applicationContext.xml&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//加载Spring的配置文件，有以下写法：</span><br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;bean.xml&quot;</span>)  会加载当前包下的bean.xml文件<br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;classpath:bean.xml&quot;</span>)  加载当前src下的bean.xml文件 【推荐使用】<br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;/bean.xml&quot;</span>)  加载当前src下的bean.xml文件<br><span class="hljs-variable">@ContextConfiguration</span>  加载当前测试类下的配置文件，文件命名必须是【类名-Context.xml】<br></code></pre></td></tr></table></figure>
<p>通过成员变量的方式，指定要测试的对象。</p>
<p><strong>打上@Autowired 注解，将会在Spring容器里查找该对象，并将Spring里的对象注入到指定的位置。</strong></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">@Autowired<br>private <span class="hljs-keyword">User</span> <span class="hljs-title">user</span>;<br></code></pre></td></tr></table></figure>
<p>3、运行测试</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RunWith</span>(SpringJUnit4ClassRunner.class)<br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;classpath:spring-context.xml&quot;</span>)<br>public class Spring4Test &#123;<br>	<br>	<span class="hljs-variable">@Autowired</span><br>	private User user;<br>	<br>	<span class="hljs-variable">@Test</span><br>	public void springTest() throws Exception &#123;<br>		<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.setName</span>(<span class="hljs-string">&quot;Spring 测试&quot;</span>);<br>		<span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(user.getName());<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果配置文件中，配置了两个同一class类型的bean，用@Qualifier(“User”)限定</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;cn.ant_nest.spring.Domain.User&quot;</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-string">&quot;init&quot;</span> <span class="hljs-attribute">destroy-method</span>=<span class="hljs-string">&quot;destroy&quot;</span>&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;User1&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;cn.ant_nest.spring.Domain.User&quot;</span>&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p><img src="/2019/11/28/Spring/Snipaste_2019-11-27_16-56-30.png" srcset="/img/loading.gif"></p>
<p>小结：</p>
<ol>
<li>通过 @RunWith和 @ContextConfiguration， 我们可以指定Spring管理测试类，自动加载配置文件，执行相关的测试。</li>
<li>框架整合的时候如果Spring的配置文件不能读取，那么整个项目是跑不起来的，而Spring的测试可以让我们在不启动服务器的情况下，自动读取相应的配置文件。</li>
</ol>
<h4 id="10、依赖注入"><a href="#10、依赖注入" class="headerlink" title="10、依赖注入"></a>10、依赖注入</h4><p>现在，我们模拟使用Spring完成Service调用dao的过程。</p>
<p>这里涉及到了一个思维的转变（即将创建交给Spring）</p>
<p>Spring中的对象都是由Spring来统一管理，但是在对象中还存在属性，这些属性实际上引用的也是别的对象，那么这些对象也是由Spring来管理的。</p>
<p>我们通过Spring给对象的属性赋值，这称为属性依赖注入。</p>
<h5 id="10-1、简单实现"><a href="#10-1、简单实现" class="headerlink" title="10.1、简单实现"></a>10.1、简单实现</h5><p>步骤分析：</p>
<p>Spring Junit Test — UserServiceImpl(IUserService) —- UserDaoImpl(IUserDao)</p>
<ul>
<li>把UserServiceImp，UserDaoImpl交给Spring管理</li>
<li>给UserServiceImpl注入dao</li>
<li>提供setter方法</li>
<li>做配置<ul>
<li>name -&gt; 类中的属性名称(setName)</li>
<li>ref -&gt; 引用的哪一个Bean的id</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//dao层</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">listUser</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//由dao层数据库查询</span><br>        System.out.println(<span class="hljs-string">&quot;模拟数据库查询数据&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        System.out.println(user.getName());<br>        System.out.println(user.getAge());<br>        System.out.println(<span class="hljs-string">&quot;模拟数据库插入数据&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//service层</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserService</span></span>&#123;	<br><br>	<span class="hljs-keyword">private</span> IUserDao userDao;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserDao</span><span class="hljs-params">(IUserDao userDao)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.userDao = userDao;<br>	&#125; <br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(User user)</span> </span>&#123;	<br>		<span class="hljs-comment">// 调用dao层方法 添加用户</span><br>		userDao.add(user);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">//test：</span><br><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Spring4Test</span> </span>&#123;<br><br>	<span class="hljs-meta">@Autowired</span><br>	<span class="hljs-keyword">private</span> IUserService userService;<br>	<br>	<span class="hljs-meta">@Test</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testName</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		userService.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;张三&quot;</span>,<span class="hljs-number">1</span>));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="xml"><span class="hljs-comment">&lt;!--applicationContext.xml--&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- 持久层  --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.dao.impl.UserDaoImpl&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-comment">&lt;!-- 业务层 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.spring.service.impl.UserServiceImpl&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span></span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> 后面的内容</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<p>bean属性的依赖注入—-手动装配和自动装配</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs lua">&lt;!<span class="hljs-comment">-- 构造方法注入 </span><br>		* &lt;constructor-<span class="hljs-built_in">arg</span>&gt; 用于配置构造方法一个参数argument<br>			name ：参数的名称<br>			value：设置普通数据<br>			ref：引用数据，一般是另一个bean id值<br>			<br>			index ：参数的索引号，从<span class="hljs-number">0</span>开始 。如果只有索引，匹配到了多个构造方法时，默认使用第一个。<br>			<span class="hljs-built_in">type</span> ：确定参数类型<br>		例如：使用名称name<br>			&lt;constructor-<span class="hljs-built_in">arg</span> name=<span class="hljs-string">&quot;username&quot;</span> value=<span class="hljs-string">&quot;jack&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>			&lt;constructor-<span class="hljs-built_in">arg</span> name=<span class="hljs-string">&quot;age&quot;</span> value=<span class="hljs-string">&quot;18&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>		例如<span class="hljs-number">2</span>：【类型<span class="hljs-built_in">type</span> 和  索引 index】<br>			&lt;constructor-<span class="hljs-built_in">arg</span> index=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span> value=<span class="hljs-string">&quot;1&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>			&lt;constructor-<span class="hljs-built_in">arg</span> index=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span> value=<span class="hljs-string">&quot;2&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>	<span class="hljs-comment">--&gt;</span><br>	&lt;bean id=<span class="hljs-string">&quot;userId&quot;</span> class=<span class="hljs-string">&quot;com.kongwei_liao.domain.User&quot;</span> &gt;<br>		&lt;constructor-<span class="hljs-built_in">arg</span> index=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span> value=<span class="hljs-string">&quot;1&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>		&lt;constructor-<span class="hljs-built_in">arg</span> index=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span> value=<span class="hljs-string">&quot;2&quot;</span>&gt;&lt;/constructor-<span class="hljs-built_in">arg</span>&gt;<br>	&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;!<span class="hljs-comment">-- setter方法注入 </span><br>		* 普通数据 <br>			&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;&quot;</span> value=<span class="hljs-string">&quot;值&quot;</span>&gt;<br>			等效<br>			&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;&quot;</span>&gt;<br>				&lt;value&gt;值<br>		* 引用数据<br>			&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;另一个bean&quot;</span>&gt;<br>			等效<br>			&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;&quot;</span>&gt;<br>				&lt;<span class="hljs-keyword">ref</span> bean=<span class="hljs-string">&quot;另一个bean&quot;</span>/&gt;<br>	<br>	<span class="hljs-comment">--&gt;</span><br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;personId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Person&quot;</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;pname&quot;</span> value=<span class="hljs-string">&quot;阳志&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;age&quot;</span>&gt;<br>			&lt;value&gt;<span class="hljs-number">1234</span>&lt;/value&gt;<br>		&lt;/<span class="hljs-keyword">property</span>&gt;<br>		<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;homeAddr&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;homeAddrId&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;companyAddr&quot;</span>&gt;<br>			&lt;<span class="hljs-keyword">ref</span> bean=<span class="hljs-string">&quot;companyAddrId&quot;</span>/&gt;<br>		&lt;/<span class="hljs-keyword">property</span>&gt;<br>	&lt;/bean&gt;<br>	<br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;homeAddrId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Address&quot;</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;addr&quot;</span> value=<span class="hljs-string">&quot;阜南&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;tel&quot;</span> value=<span class="hljs-string">&quot;911&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>	&lt;/bean&gt;<br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;companyAddrId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Address&quot;</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;addr&quot;</span> value=<span class="hljs-string">&quot;北京八宝山&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>		&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;tel&quot;</span> value=<span class="hljs-string">&quot;120&quot;</span>&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br>	&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;!<span class="hljs-comment">-- 了解内容：P命名空间，对“setter方法注入”进行简化</span><br>	替换&lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;属性名&quot;</span>&gt;，而是在&lt;bean p:属性名-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;引用值&quot;</span>&gt;<br>	p命名空间使用前提，必须添加命名空间：xmlns:p=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="hljs-comment">--&gt;</span><br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;personId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;com.itheima.f_xml.c_p.Person&quot;</span> <br>		p:pname=<span class="hljs-string">&quot;禹太璞&quot;</span> p:age=<span class="hljs-string">&quot;22&quot;</span> <br>		p:homeAddr-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;homeAddrId&quot;</span> p:companyAddr-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;companyAddrId&quot;</span>&gt;<br>	&lt;/bean&gt;<br>	<br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;homeAddrId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Address&quot;</span><br>		p:addr=<span class="hljs-string">&quot;DG&quot;</span> p:tel=<span class="hljs-string">&quot;东莞&quot;</span>&gt;<br>	&lt;/bean&gt;<br>	&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;companyAddrId&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Address&quot;</span><br>		p:addr=<span class="hljs-string">&quot;DG&quot;</span> p:tel=<span class="hljs-string">&quot;岛国&quot;</span>&gt;<br>	&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!-- 了解内容：Spring EL表达式</span></span><br><span class="xml">	对<span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>进行统一编程，所有的内容都使用value</span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;表达式&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span><br><span class="xml">	#</span><span class="hljs-template-variable">&#123;123&#125;</span><span class="xml">、#</span><span class="hljs-template-variable">&#123;&#x27;jack&#x27;&#125;</span><span class="xml"> ： 数字、字符串</span><br><span class="xml">	#</span><span class="hljs-template-variable">&#123;beanId&#125;</span><span class="xml">	：另一个bean引用</span><br><span class="xml">	#</span><span class="hljs-template-variable">&#123;beanId.propName&#125;</span><span class="xml">	：操作数据</span><br><span class="xml">	#</span><span class="hljs-template-variable">&#123;beanId.toString()&#125;</span><span class="xml">	：执行方法</span><br><span class="xml">	#</span><span class="hljs-template-variable">&#123;T(类).字段|方法&#125;</span><span class="xml">	：静态方法或字段</span><br><span class="xml">--&gt;</span><br><span class="xml">	<span class="hljs-comment">&lt;!-- </span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cname&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;&#x27;jack&#x27;&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cname&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;customerId.cname.toUpperCase()&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">			通过另一个bean，获得属性，调用的方法</span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cname&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;customerId.cname?.toUpperCase()&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">			?.  如果对象不为null，将调用方法</span><br><span class="xml">	--&gt;</span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customerId&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.Customer&quot;</span> &gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cname&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;customerId.cname?.toUpperCase()&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pi&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#</span></span></span><span class="hljs-template-variable">&#123;T(java.lang.<span class="hljs-keyword">Math</span>).PI&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs xquery">&lt;!-- <br>		集合的注入都是给<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>添加子标签</span><br><span class="xml">			数组：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span></span><br><span class="xml">			List：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span></span><br><span class="xml">			Set：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span></span><br><span class="xml">			Map：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span> ，map存放k/v 键值对，使用</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span>描述</span><br><span class="xml">			Properties：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span>  </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span></span><span class="xml">  【】</span><br><span class="xml">			</span><br><span class="xml">		普通数据：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">		引用数据：</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span></span><br><span class="xml">	--&gt;</span><br><span class="xml">	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;collDataId&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.kongwei_liao.domain.CollData&quot;</span> &gt;</span></span><br><span class="xml">		</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;arrayData&quot;</span>&gt;</span></span><br><span class="xml">			</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>DS<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>DZD<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>屌丝<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>屌中屌<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		</span><br><span class="xml">		</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;listData&quot;</span>&gt;</span></span><br><span class="xml">			</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>于嵩楠<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>曾卫<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>杨煜<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>曾小贤<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		</span><br><span class="xml">		</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;setData&quot;</span>&gt;</span></span><br><span class="xml">			</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>停封<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>薄纸<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>关系<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		</span><br><span class="xml">		</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapData&quot;</span>&gt;</span></span><br><span class="xml">			</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;jack&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;杰克&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span></span><br><span class="xml">					</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>rose<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span></span><br><span class="xml">					</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>肉丝<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span><br><span class="xml">				<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">		</span><br><span class="xml">		</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;propsData&quot;</span>&gt;</span></span><br><span class="xml">			</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;高富帅&quot;</span>&gt;</span>嫐<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;白富美&quot;</span>&gt;</span>嬲<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span></span><br><span class="xml">				</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;男屌丝&quot;</span>&gt;</span>挊<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span></span><br><span class="xml">			<span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span></span><br><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br></code></pre></td></tr></table></figure>




<h5 id="10-2、小结"><a href="#10-2、小结" class="headerlink" title="10.2、小结"></a>10.2、小结</h5><p>Spring 依赖注入，是通过反射获取对象的setter方法实现的。所以我们通过xml配置实现依赖注入，必须为我们的类添加依赖类的提供setter方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">setUserDao</span>(<span class="hljs-params">IUserDao userDao</span>)</span> &#123;<br>	<span class="hljs-built_in">this</span>.userDao = userDao;<br>&#125; <br></code></pre></td></tr></table></figure>
<p>后面我们还会学习其他的 依赖注入复杂对象的方法。</p>
<h4 id="11、Spring全注解实现三层依赖注入"><a href="#11、Spring全注解实现三层依赖注入" class="headerlink" title="11、Spring全注解实现三层依赖注入"></a>11、Spring全注解实现三层依赖注入</h4><p>在Java中写Xml配置Bean还是比较麻烦，因此，Spring还提供了使用注解来配置的文件。我们可以来看一下，注解是怎么来配置这个Xml的</p>
<ol>
<li>修改xml文件，引入新的约束</li>
<li>指定需要扫描的包，里面有要交给Spring管理的类</li>
<li>修改类，在类上面加上注解，让Spring 可以扫描到</li>
</ol>
<p>1、修改XML配置context命名空间，让Spring扫描类与支持注解</p>
<p><img src="/2019/11/28/Spring/image-20191228191254644.png" srcset="/img/loading.gif" alt="image-20191228191254644"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/context</span></span><br><span class="hljs-tag"><span class="hljs-string">	http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 配置让Spring扫描类与支持注解--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;cn.kongwei_liao.*&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>2、在类里面加上注解</p>
<blockquote>
<p>@Component  普通仓库（domain层）取代&lt;bean class=””&gt;</p>
<p>@Component(“id”) 取代 &lt;bean id=”” class=””&gt;</p>
<p>WEB开发，提供了3个@Component注解衍生注解（功能一样），&lt;bean class=””&gt;</p>
<ol>
<li>@Repository  仓库（其实就是dao层）</li>
<li>@Service    （service层）</li>
<li>@Controller  控制层(servlet、action)</li>
</ol>
</blockquote>
<p>3、依赖注入</p>
<blockquote>
<p>依赖注入，给私有字段设置，也可以给setter方法设置</p>
<p>​    普通值：@Value(“”)</p>
<p>​    引用值：</p>
<p>​        方式1：按照【类型】注入</p>
<p>​            @Autowired</p>
<p>​        方式2：按照【名称】注入1</p>
<p>​            @Autowired</p>
<p>​            @Qualifier(“名称”)</p>
<p>​        方式3：按照【名称】注入2</p>
<p>​            @Resource(“名称”)</p>
</blockquote>
<p>4、生命周期</p>
<blockquote>
<p>初始化：@PostConstruct</p>
<p>销毁：@PreDestroy</p>
</blockquote>
<p>5、作用域</p>
<blockquote>
<p>@Scope(“prototype”) 多例</p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs perl">//普通仓库，应该就是（实体类）那一层了<br><span class="hljs-keyword">package</span> cn.kongwei_liao.spring.domain;<br><br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class User &#123;<br>    private String name;<br>    private Integer age;<br><br>    public User()&#123;&#125;;<br>    public User(String name, <span class="hljs-keyword">int</span> age) &#123;<br>        setName(name);<br>        setAge(age);<br>    &#125;<br><br>    public String getName() &#123;<span class="hljs-keyword">return</span> name;&#125;<br>    public void setName(String name) &#123;this.name = name;&#125;<br>    public Integer getAge() &#123;<span class="hljs-keyword">return</span> age;&#125;<br>    public void setAge(Integer age) &#123;this.age = age;&#125;<br><br>    public void init()&#123;System.out.println(<span class="hljs-string">&quot;初始化方法&quot;</span>);&#125;<br>    public void destroy()&#123;System.out.println(<span class="hljs-string">&quot;销毁&quot;</span>);&#125;<br>&#125;<br>//<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><br>@Repository<br>public class UserDaoImpl implements IUserDao&#123;<br>	@Override<br>	public void add(User user) &#123;		<br>		System.out.println(<span class="hljs-string">&quot;成功添加&quot;</span>+user.getName()+<span class="hljs-string">&quot;到数据库...&quot;</span>);	<br>	&#125;<br>&#125;<br>//<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><br>@Service<br>public class UserServiceImpl implements IUserService&#123;<br>	@Autowired<br>	private IUserDao userDao;<br><br>	@Override<br>	public void add(User user) &#123;	<br>		// 调用dao层方法 添加用户<br>		userDao.add(user);<br>	&#125;<br>&#125;<br>//<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><br>@Controller<br>public class UserServlet extends HttpServlet&#123;<br>	@Autowired<br>	private IUserService userService;<br>	<br>	public void addUser() &#123;<br>		User user = new User(<span class="hljs-string">&quot;张三&quot;</span>,<span class="hljs-number">22</span>);<br>		// 需要调用Service方法 新增用户到库<br>		userService.add(user);	<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RunWith</span>(SpringJUnit4ClassRunner.class)<br><span class="hljs-variable">@ContextConfiguration</span>(<span class="hljs-string">&quot;classpath:applicationContext.xml&quot;</span>)<br>public class Spring4Test &#123;<br><br>	<span class="hljs-variable">@Autowired</span><br>	private UserServlet userServlet;<br>	<br>	<span class="hljs-variable">@Test</span><br>	public void testName() throws Exception &#123;<br>		<span class="hljs-selector-tag">userServlet</span><span class="hljs-selector-class">.addUser</span>();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>小结:</p>
<p>初学使用xml版手动注入，熟练之后可以使用xml自动注入</p>
<p>以后趋势：注解版</p>
<p>如果是注解版，就全部使用注解（自己写类），不要混用，其它框架已经写好的类仍然使用xml进行配置，如果是xml版，在测试的使用必须使用注解注入（因为测试框架使用注解版）</p>
<p>只有自己写的类，才可以全部用注解，别人写的类使用注解必须去修改别人的源码，添加响应的注解标志。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/Spring/">Spring</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/12/10/JavaScript/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JavaScript</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/11/28/SpringMVC/">
                        <span class="hidden-mobile">SpringMVC</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="SOHUCS" sid='http://example.com/2019/11/28/Spring/'></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('SOHUCS', function() {
      var appid = 'cyvjg8eoK';
      var conf = '2085177cb8fe4ee04d95c509f52d4b8b';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
        window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
      } else {
        Fluid.utils.createScript("https://changyan.sohu.com/upload/changyan.js", function() {
          window.changyan.api.config({
            appid: appid,
            conf: conf
          })
        });
      }
    })
  </script>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
